{
  "version": 3,
  "sources": ["../../../src/rss.ts", "../../../src/crypto.ts", "../../../src/rate_limit_do.ts", "../../../src/ingest.ts", "../../../src/auth.ts", "../../../src/metrics_queries.ts", "../../../src/index.ts", "../../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-kjJbIs/middleware-insertion-facade.js", "../../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-kjJbIs/middleware-loader.entry.ts"],
  "sourceRoot": "/Users/jks142857/Desktop/haiphen-aboutme/haiphen-api/.wrangler/tmp/dev-WyjHZn",
  "sourcesContent": ["type DailyMetricRow = { kpi: string; value: string };\ntype DailyMetrics = {\n  date: string;\n  updated_at: string;\n  headline: string;\n  summary: string;\n  rows: DailyMetricRow[];\n  overlay: unknown;\n};\n\nfunction esc(s: string): string {\n  return s\n    .replaceAll(\"&\", \"&amp;\")\n    .replaceAll(\"<\", \"&lt;\")\n    .replaceAll(\">\", \"&gt;\")\n    .replaceAll('\"', \"&quot;\")\n    .replaceAll(\"'\", \"&apos;\");\n}\n\nexport function buildRss(d: DailyMetrics): string {\n  const title = `Haiphen Trading Metrics \u2014 ${d.date}`;\n  const link = `https://haiphen.io/docs/#docs:metrics-daily`;\n  const guid = `haiphen-metrics:${d.date}`;\n\n  const rows = d.rows\n    .map(r => `<li><strong>${esc(r.kpi)}:</strong> ${esc(r.value)}</li>`)\n    .join(\"\");\n\n  const desc = `\n    <p>${esc(d.headline)}</p>\n    <p>${esc(d.summary)}</p>\n    <ul>${rows}</ul>\n  `.trim();\n\n  return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<rss version=\"2.0\">\n  <channel>\n    <title>${esc(\"Haiphen Trading Metrics\")}</title>\n    <link>${esc(link)}</link>\n    <description>${esc(\"Daily high-frequency execution telemetry, delivered as RSS.\")}</description>\n    <language>en-us</language>\n\n    <item>\n      <title>${esc(title)}</title>\n      <link>${esc(link)}</link>\n      <guid isPermaLink=\"false\">${esc(guid)}</guid>\n      <pubDate>${esc(new Date(d.updated_at).toUTCString())}</pubDate>\n      <description><![CDATA[${desc}]]></description>\n    </item>\n  </channel>\n</rss>`;\n}", "export function hex(bytes: ArrayBuffer): string {\n  return [...new Uint8Array(bytes)].map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\n}\n\nexport async function sha256Hex(input: string): Promise<string> {\n  const data = new TextEncoder().encode(input);\n  const digest = await crypto.subtle.digest(\"SHA-256\", data);\n  return hex(digest);\n}\n\nexport async function hmacSha256Hex(secret: string, payload: string): Promise<string> {\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    new TextEncoder().encode(secret),\n    { name: \"HMAC\", hash: \"SHA-256\" },\n    false,\n    [\"sign\"]\n  );\n  const sig = await crypto.subtle.sign(\"HMAC\", key, new TextEncoder().encode(payload));\n  return hex(sig);\n}\n\n/**\n * Timing-safe compare for hex strings (best-effort in JS).\n */\nexport function safeEqual(a: string, b: string): boolean {\n  if (a.length !== b.length) return false;\n  let out = 0;\n  for (let i = 0; i < a.length; i++) out |= a.charCodeAt(i) ^ b.charCodeAt(i);\n  return out === 0;\n}\n\nexport function json<T>(v: T): string {\n  return JSON.stringify(v);\n}\n\nexport function uuid(): string {\n  return crypto.randomUUID();\n}", "export type RateLimitPlan = {\n  limitPerMinute: number;   // e.g. 60 or 600\n  burst: number;            // e.g. 10 or 60\n};\n\ntype State = {\n  tokens: number;\n  lastRefillMs: number;\n};\n\nexport class RateLimiterDO {\n  private state: DurableObjectState;\n\n  constructor(state: DurableObjectState) {\n    this.state = state;\n  }\n\n  async fetch(req: Request): Promise<Response> {\n    const url = new URL(req.url);\n    if (url.pathname !== \"/consume\") return new Response(\"Not found\", { status: 404 });\n\n    const body = await req.json().catch(() => null) as null | {\n      plan: RateLimitPlan;\n      cost?: number;\n      nowMs?: number;\n    };\n\n    if (!body?.plan) return new Response(\"Bad request\", { status: 400 });\n\n    const cost = Math.max(1, Math.floor(body.cost ?? 1));\n    const nowMs = body.nowMs ?? Date.now();\n\n    const key = \"rl_state\";\n    const stored = (await this.state.storage.get<State>(key)) ?? null;\n\n    const limit = body.plan.limitPerMinute;\n    const burst = body.plan.burst;\n\n    // refill rate: tokens per ms\n    const refillPerMs = limit / 60_000;\n\n    let tokens = stored?.tokens ?? burst;\n    let lastRefillMs = stored?.lastRefillMs ?? nowMs;\n\n    // refill\n    const elapsed = Math.max(0, nowMs - lastRefillMs);\n    tokens = Math.min(burst, tokens + elapsed * refillPerMs);\n    lastRefillMs = nowMs;\n\n    const allowed = tokens >= cost;\n    if (allowed) tokens -= cost;\n\n    // compute reset: when tokens reach at least 1\n    const msUntil1 = tokens >= 1 ? 0 : Math.ceil((1 - tokens) / refillPerMs);\n    const resetMs = nowMs + msUntil1;\n\n    await this.state.storage.put<State>(key, { tokens, lastRefillMs });\n\n    const res = {\n      allowed,\n      remaining: Math.max(0, Math.floor(tokens)),\n      limit,\n      resetMs\n    };\n\n    return new Response(JSON.stringify(res), {\n      status: 200,\n      headers: { \"Content-Type\": \"application/json\" }\n    });\n  }\n}", "// haiphen-api/src/ingest.ts\nimport { json } from \"./crypto\";\n\nexport type NormalizedTradesJson = {\n  date: string;\n  updated_at: string;\n  headline: string;\n  summary: string;\n  rows: Array<{ kpi: string; value: string }>;\n  overlay: {\n    seriesByKpi: Record<string, Array<{ t: string; v: number; src?: string }>>;\n    extremes: {\n      byKpi?: Record<string, { hi?: unknown[]; lo?: unknown[]; items?: unknown[] }>;\n      legacyKpi?: string;\n      source?: string;\n    };\n    portfolioAssets: Array<{ trade_id: number; symbol: string | null; contract_name: string }>;\n  };\n  source?: string;\n};\n\n// ---- normalizeTradesJson (ADD THIS; do not remove existing code) ----\n\nfunction _isObj(v: unknown): v is Record<string, any> {\n  return !!v && typeof v === \"object\" && !Array.isArray(v);\n}\n\nfunction _asString(v: unknown): string {\n  if (typeof v === \"string\") return v;\n  if (typeof v === \"number\" && Number.isFinite(v)) return String(v);\n  return \"\";\n}\n\nfunction _mustString(v: unknown, field: string): string {\n  const s = _asString(v).trim();\n  if (!s) throw new Error(`normalizeTradesJson: missing/invalid ${field}`);\n  return s;\n}\n\n/**\n * Normalize inbound trades.json into the stable shape expected by D1 ingestion.\n */\nexport function normalizeTradesJson(payload: unknown): NormalizedTradesJson {\n  if (!_isObj(payload)) throw new Error(\"normalizeTradesJson: payload must be an object\");\n\n  const date = _mustString(payload.date, \"date\");\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n    throw new Error(\"normalizeTradesJson: date must be YYYY-MM-DD\");\n  }\n\n  const updated_at = _asString(payload.updated_at).trim() || new Date().toISOString();\n  const headline = _asString(payload.headline).trim() || `Haiphen metrics for ${date}`;\n  const summary = _asString(payload.summary).trim() || \"\";\n\n  const rawRows = Array.isArray((payload as any).rows)\n    ? (payload as any).rows\n    : Array.isArray((payload as any).kpis)\n      ? (payload as any).kpis\n      : [];\n\n  const rows: Array<{ kpi: string; value: string }> = [];\n  for (const r of rawRows) {\n    if (!_isObj(r)) continue;\n    const kpi = (_asString((r as any).kpi) || _asString((r as any).name) || _asString((r as any).label)).trim();\n    const value = _asString((r as any).value ?? (r as any).val ?? (r as any).text).trim();\n    if (!kpi) continue;\n    rows.push({ kpi, value });\n  }\n\n  const overlayRaw = _isObj((payload as any).overlay) ? (payload as any).overlay : {};\n\n  const seriesByKpiRaw =\n    (_isObj((overlayRaw as any).seriesByKpi) ? (overlayRaw as any).seriesByKpi :\n     _isObj((overlayRaw as any).series) ? (overlayRaw as any).series :\n     {}) as Record<string, any>;\n\n  const seriesByKpi: Record<string, Array<{ t: string; v: number; src?: string }>> = {};\n  for (const [kpi, pts] of Object.entries(seriesByKpiRaw ?? {})) {\n    if (!Array.isArray(pts)) continue;\n    const normPts: Array<{ t: string; v: number; src?: string }> = [];\n\n    for (const p of pts) {\n      if (!_isObj(p)) continue;\n      const t = _asString((p as any).t ?? (p as any).time ?? (p as any).ts).trim();\n      const vRaw = (p as any).v ?? (p as any).value;\n      const v = typeof vRaw === \"number\" ? vRaw : Number(vRaw);\n      if (!t || !Number.isFinite(v)) continue;\n      const src = _asString((p as any).src).trim() || undefined;\n      normPts.push(src ? { t, v, src } : { t, v });\n    }\n\n    if (normPts.length) seriesByKpi[kpi] = normPts;\n  }\n\n  const extremesRaw = _isObj((overlayRaw as any).extremes) ? (overlayRaw as any).extremes : {};\n  const byKpi = _isObj((extremesRaw as any).byKpi) ? (extremesRaw as any).byKpi : undefined;\n\n  const extremes = {\n    byKpi: byKpi as Record<string, { hi?: unknown[]; lo?: unknown[]; items?: unknown[] }> | undefined,\n    legacyKpi: _asString((extremesRaw as any).legacyKpi).trim() || undefined,\n    source: _asString((extremesRaw as any).source).trim() || undefined\n  };\n\n  const assetsRaw = Array.isArray((overlayRaw as any).portfolioAssets)\n    ? (overlayRaw as any).portfolioAssets\n    : Array.isArray((overlayRaw as any).assets)\n      ? (overlayRaw as any).assets\n      : [];\n\n  const portfolioAssets: Array<{ trade_id: number; symbol: string | null; contract_name: string }> = [];\n  for (const a of assetsRaw) {\n    if (!_isObj(a)) continue;\n\n    const tradeIdRaw = (a as any).trade_id ?? (a as any).tradeId ?? (a as any).id;\n    const trade_id = typeof tradeIdRaw === \"number\" ? Math.trunc(tradeIdRaw) : Math.trunc(Number(tradeIdRaw));\n\n    const contract_name = _asString((a as any).contract_name ?? (a as any).contractName ?? (a as any).contract).trim();\n    const symbol = _asString((a as any).symbol).trim() || null;\n\n    if (!Number.isFinite(trade_id) || !contract_name) continue;\n    portfolioAssets.push({ trade_id, symbol, contract_name });\n  }\n\n  const source = _asString((payload as any).source).trim() || undefined;\n\n  return {\n    date,\n    updated_at,\n    headline,\n    summary,\n    rows,\n    overlay: { seriesByKpi, extremes, portfolioAssets },\n    source\n  };\n}\n\nfunction parseNumericValue(raw: string): { value_num: number | null; value_kind: \"number\" | \"percent\" | \"text\" } {\n  const s = String(raw ?? \"\").trim();\n  if (!s) return { value_num: null, value_kind: \"text\" };\n\n  // percent\n  if (/%$/.test(s)) {\n    const n = Number(s.replace(/[%+,]/g, \"\").trim());\n    return Number.isFinite(n) ? { value_num: n, value_kind: \"percent\" } : { value_num: null, value_kind: \"text\" };\n  }\n\n  // plain number-ish (allow commas, leading +/-, decimals)\n  const numish = s.replace(/,/g, \"\").trim();\n  if (/^[+-]?\\d+(\\.\\d+)?$/.test(numish)) {\n    const n = Number(numish);\n    return Number.isFinite(n) ? { value_num: n, value_kind: \"number\" } : { value_num: null, value_kind: \"text\" };\n  }\n\n  return { value_num: null, value_kind: \"text\" };\n}\n\nfunction asRecord(v: unknown): Record<string, unknown> | null {\n  if (!v || typeof v !== \"object\" || Array.isArray(v)) return null;\n  return v as Record<string, unknown>;\n}\n\nfunction numOrNull(v: unknown): number | null {\n  const n = typeof v === \"number\" ? v : typeof v === \"string\" ? Number(v) : NaN;\n  return Number.isFinite(n) ? n : null;\n}\n\nfunction strOrNull(v: unknown): string | null {\n  return typeof v === \"string\" && v.length ? v : null;\n}\n\nfunction intOrNull(v: unknown): number | null {\n  const n = numOrNull(v);\n  if (n === null) return null;\n  return Number.isFinite(n) ? Math.trunc(n) : null;\n}\n\nexport async function upsertMetricsDaily(env: { DB: D1Database }, payload: NormalizedTradesJson): Promise<void> {\n  const date = payload.date;\n\n  // 1) Upsert archive row (source of truth)\n  await env.DB.prepare(`\n    INSERT INTO metrics_daily(date, updated_at, headline, summary, rows_json, overlay_json)\n    VALUES (?, ?, ?, ?, ?, ?)\n    ON CONFLICT(date) DO UPDATE SET\n      updated_at=excluded.updated_at,\n      headline=excluded.headline,\n      summary=excluded.summary,\n      rows_json=excluded.rows_json,\n      overlay_json=excluded.overlay_json\n  `).bind(\n    payload.date,\n    payload.updated_at,\n    payload.headline,\n    payload.summary,\n    json(payload.rows),\n    json(payload.overlay)\n  ).run();\n\n  // 2) Clear derived tables for this date (idempotent refresh)\n  await env.DB.batch([\n    env.DB.prepare(`DELETE FROM metrics_kpi_values WHERE date = ?`).bind(date),\n    env.DB.prepare(`DELETE FROM metrics_series_points WHERE date = ?`).bind(date),\n    env.DB.prepare(`DELETE FROM metrics_extremes_items WHERE date = ?`).bind(date),\n    env.DB.prepare(`DELETE FROM metrics_portfolio_assets WHERE date = ?`).bind(date),\n  ]);\n\n  // 3) Rebuild derived tables (chunked)\n  const stmts: D1PreparedStatement[] = [];\n\n  // KPI rows\n  for (const r of payload.rows ?? []) {\n    const kpi = String(r?.kpi ?? \"\").trim();\n    const value_text = String(r?.value ?? \"\").trim();\n    if (!kpi) continue;\n\n    const parsed = parseNumericValue(value_text);\n    stmts.push(\n      env.DB.prepare(`\n        INSERT INTO metrics_kpi_values(date, kpi, value_text, value_num, value_kind)\n        VALUES (?, ?, ?, ?, ?)\n      `).bind(date, kpi, value_text, parsed.value_num, parsed.value_kind)\n    );\n  }\n\n  // Series points\n  const sbk = payload.overlay?.seriesByKpi ?? {};\n  for (const [kpi, points] of Object.entries(sbk)) {\n    if (!kpi || !Array.isArray(points)) continue;\n    for (const p of points) {\n      const t = strOrNull((p as any)?.t);\n      const v = numOrNull((p as any)?.v);\n      const src = strOrNull((p as any)?.src);\n      if (!t || v === null) continue;\n\n      stmts.push(\n        env.DB.prepare(`\n          INSERT INTO metrics_series_points(date, kpi, t, v, src)\n          VALUES (?, ?, ?, ?, ?)\n        `).bind(date, kpi, t, v, src)\n      );\n    }\n  }\n\n  // Extremes items\n  const byKpi = payload.overlay?.extremes?.byKpi ?? {};\n  for (const [kpi, v] of Object.entries(byKpi)) {\n    const obj = asRecord(v);\n    if (!kpi || !obj) continue;\n\n    const hi = Array.isArray(obj.hi) ? obj.hi : [];\n    const lo = Array.isArray(obj.lo) ? obj.lo : [];\n\n    const insertOne = (side: \"hi\" | \"lo\", item: unknown, rank: number) => {\n      const rec = asRecord(item) ?? {};\n      const trade_id = intOrNull(rec.trade_id);\n      const symbol = strOrNull(rec.symbol);\n      const contract_name = strOrNull(rec.contract_name) ?? \"\";\n      if (!contract_name) return;\n\n      stmts.push(\n        env.DB.prepare(`\n          INSERT INTO metrics_extremes_items(\n            date, kpi, side, rank,\n            trade_id, symbol, contract_name,\n            metric_raw, metric_abs,\n            individual_pnl, abs_individual_pnl,\n            percent_change, cost_basis, qty,\n            bid_price, ask_price, mid_price, mid_ts,\n            mid_mark_pnl, liquidity_drag,\n            item_json\n          )\n          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n        `).bind(\n          date,\n          kpi,\n          side,\n          rank,\n          trade_id,\n          symbol,\n          contract_name,\n          numOrNull(rec.metric_raw),\n          numOrNull(rec.metric_abs),\n          numOrNull(rec.individual_pnl),\n          numOrNull(rec.abs_individual_pnl),\n          numOrNull(rec.percent_change),\n          numOrNull(rec.cost_basis),\n          numOrNull(rec.qty),\n          numOrNull(rec.bid_price),\n          numOrNull(rec.ask_price),\n          numOrNull(rec.mid_price),\n          strOrNull(rec.mid_ts),\n          numOrNull(rec.mid_mark_pnl),\n          numOrNull(rec.liquidity_drag),\n          JSON.stringify(item)\n        )\n      );\n    };\n\n    for (let i = 0; i < hi.length; i++) insertOne(\"hi\", hi[i], i + 1);\n    for (let i = 0; i < lo.length; i++) insertOne(\"lo\", lo[i], i + 1);\n  }\n\n  // Portfolio assets\n  for (const a of payload.overlay?.portfolioAssets ?? []) {\n    const trade_id = intOrNull((a as any)?.trade_id);\n    const contract_name = strOrNull((a as any)?.contract_name);\n    const symbol = strOrNull((a as any)?.symbol);\n    if (trade_id === null || !contract_name) continue;\n\n    stmts.push(\n      env.DB.prepare(`\n        INSERT INTO metrics_portfolio_assets(date, trade_id, symbol, contract_name)\n        VALUES (?, ?, ?, ?)\n      `).bind(date, trade_id, symbol, contract_name)\n    );\n  }\n\n  const chunkSize = 200;\n  for (let i = 0; i < stmts.length; i += chunkSize) {\n    await env.DB.batch(stmts.slice(i, i + chunkSize));\n  }\n}", "// haiphen-api/src/auth.ts\nexport type AuthedUser = {\n  login: string; // GitHub login / sub\n  name?: string | null;\n  avatar?: string | null;\n  email?: string | null;\n};\n\nfunction base64UrlToBytes(b64url: string): Uint8Array {\n  const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4);\n  const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const raw = atob(b64);\n  const out = new Uint8Array(raw.length);\n  for (let i = 0; i < raw.length; i++) out[i] = raw.charCodeAt(i);\n  return out;\n}\n\nasync function hmacSha256Verify(secret: string, data: string, sigB64Url: string): Promise<boolean> {\n  const key = await crypto.subtle.importKey(\n    \"raw\",\n    new TextEncoder().encode(secret),\n    { name: \"HMAC\", hash: \"SHA-256\" },\n    false,\n    [\"verify\"]\n  );\n  const sig = base64UrlToBytes(sigB64Url);\n  return crypto.subtle.verify(\"HMAC\", key, sig, new TextEncoder().encode(data));\n}\n\nexport function parseCookie(req: Request, name: string): string | null {\n  const h = req.headers.get(\"Cookie\") || \"\";\n  // simple, safe-ish cookie parsing\n  const parts = h.split(\";\").map((x) => x.trim());\n  for (const p of parts) {\n    const idx = p.indexOf(\"=\");\n    if (idx <= 0) continue;\n    const k = p.slice(0, idx).trim();\n    if (k !== name) continue;\n    return decodeURIComponent(p.slice(idx + 1));\n  }\n  return null;\n}\n\nexport type JwtClaims = {\n  sub: string;\n  name?: string | null;\n  avatar?: string | null;\n  email?: string | null;\n  aud?: string | null;\n  iat?: number;\n  exp?: number;\n  jti?: string;\n};\n\nexport async function requireUserFromAuthCookie(req: Request, jwtSecret: string): Promise<AuthedUser> {\n  const token = parseCookie(req, \"auth\");\n  if (!token) throw Object.assign(new Error(\"Missing auth cookie\"), { status: 401 });\n\n  const parts = token.split(\".\");\n  if (parts.length !== 3) throw Object.assign(new Error(\"Malformed JWT\"), { status: 401 });\n\n  const [hB64, pB64, sB64] = parts;\n  const signed = `${hB64}.${pB64}`;\n\n  const ok = await hmacSha256Verify(jwtSecret, signed, sB64);\n  if (!ok) throw Object.assign(new Error(\"Invalid JWT signature\"), { status: 401 });\n\n  const payloadJson = new TextDecoder().decode(base64UrlToBytes(pB64));\n  const claims = JSON.parse(payloadJson) as JwtClaims;\n\n  // Optional but recommended: pin the audience to your auth app\n  // Your cookie shows aud = \"haiphen-auth\"\n  if (claims.aud && claims.aud !== \"haiphen-auth\") {\n    throw Object.assign(new Error(\"Invalid JWT audience\"), { status: 401 });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (typeof claims.exp === \"number\" && claims.exp < now) {\n    throw Object.assign(new Error(\"Expired session\"), { status: 401 });\n  }\n\n  if (!claims.sub) throw Object.assign(new Error(\"JWT missing sub\"), { status: 401 });\n\n  return {\n    login: claims.sub,\n    name: claims.name ?? null,\n    avatar: claims.avatar ?? null,\n    email: claims.email ?? null,\n  };\n}", "// haiphen-api/src/metrics_queries.ts\nexport async function getKpis(env: { DB: D1Database }, date: string) {\n  const rows = await env.DB.prepare(`\n    SELECT kpi, value_text, value_num, value_kind\n    FROM metrics_kpi_values\n    WHERE date = ?\n    ORDER BY kpi ASC\n  `).bind(date).all<{ kpi: string; value_text: string; value_num: number | null; value_kind: string }>();\n\n  return rows.results ?? [];\n}\n\nexport async function getSeries(env: { DB: D1Database }, date: string, kpi: string, from?: string, to?: string, limit = 500) {\n  const lim = Math.min(2000, Math.max(1, limit));\n\n  // build query dynamically but safely\n  let sql = `\n    SELECT t, v, src\n    FROM metrics_series_points\n    WHERE date = ? AND kpi = ?\n  `;\n  const binds: any[] = [date, kpi];\n\n  if (from) { sql += ` AND t >= ?`; binds.push(from); }\n  if (to) { sql += ` AND t <= ?`; binds.push(to); }\n\n  sql += ` ORDER BY t ASC LIMIT ?`;\n  binds.push(lim);\n\n  const rows = await env.DB.prepare(sql).bind(...binds).all<{ t: string; v: number; src: string | null }>();\n  return rows.results ?? [];\n}\n\nexport async function getExtremes(env: { DB: D1Database }, date: string, kpi: string, side: \"hi\" | \"lo\", limit = 10) {\n  const lim = Math.min(50, Math.max(1, limit));\n\n  const rows = await env.DB.prepare(`\n    SELECT\n      rank, trade_id, symbol, contract_name,\n      metric_raw, metric_abs, individual_pnl, abs_individual_pnl,\n      percent_change, cost_basis, qty,\n      bid_price, ask_price, mid_price, mid_ts,\n      mid_mark_pnl, liquidity_drag,\n      item_json\n    FROM metrics_extremes_items\n    WHERE date = ? AND kpi = ? AND side = ?\n    ORDER BY rank ASC\n    LIMIT ?\n  `).bind(date, kpi, side, lim).all<any>();\n\n  return (rows.results ?? []).map(r => ({\n    ...r,\n    item: JSON.parse(r.item_json)\n  }));\n}\n\nexport async function getPortfolioAssets(env: { DB: D1Database }, date: string, symbol?: string, limit = 200) {\n  const lim = Math.min(2000, Math.max(1, limit));\n\n  if (symbol) {\n    const rows = await env.DB.prepare(`\n      SELECT trade_id, symbol, contract_name\n      FROM metrics_portfolio_assets\n      WHERE date = ? AND symbol = ?\n      ORDER BY trade_id DESC\n      LIMIT ?\n    `).bind(date, symbol, lim).all<any>();\n    return rows.results ?? [];\n  }\n\n  const rows = await env.DB.prepare(`\n    SELECT trade_id, symbol, contract_name\n    FROM metrics_portfolio_assets\n    WHERE date = ?\n    ORDER BY trade_id DESC\n    LIMIT ?\n  `).bind(date, lim).all<any>();\n\n  return rows.results ?? [];\n}", "import { buildRss } from \"./rss\";\nimport { hmacSha256Hex, json, safeEqual, sha256Hex, uuid } from \"./crypto\";\nimport { RateLimiterDO, RateLimitPlan } from \"./rate_limit_do\";\nimport { normalizeTradesJson, upsertMetricsDaily } from \"./ingest\";\nimport { requireUserFromAuthCookie } from \"./auth\";\nimport { getExtremes, getKpis, getPortfolioAssets, getSeries } from \"./metrics_queries\";\n\n// Export DO class for Wrangler\nexport { RateLimiterDO };\n\ntype TradesJson = {\n  date: string;\n  updated_at: string;\n  headline: string;\n  summary: string;\n  rows: Array<{ kpi: string; value: string }>;\n  overlay: {\n    seriesByKpi: Record<string, Array<{ t: string; v: number; src?: string }>>;\n    extremes: {\n      byKpi?: Record<string, { hi?: any[]; lo?: any[]; items?: any[] }>;\n      legacyKpi?: string;\n      source?: string;\n    };\n    portfolioAssets: Array<{ trade_id: number; symbol: string | null; contract_name: string }>;\n  };\n  source?: string;\n};\n\ntype Env = {\n  DB: D1Database;\n  REVOKE_KV: KVNamespace;\n  CACHE_KV: KVNamespace;\n  RATE_LIMITER: DurableObjectNamespace;\n\n  // Shared with haiphen-auth so we can verify the same cookie JWT for key issuance.\n  JWT_SECRET: string;\n\n  // Pepper used to hash API keys (server-side secret; rotate carefully).\n  API_KEY_PEPPER: string;\n\n  // Admin token for privileged ops\n  ADMIN_TOKEN: string;\n\n  // Webhook signing: optional global secret salt (per-hook secret is stored anyway)\n  WEBHOOK_SALT?: string;\n\n  // Optional: for CORS allowlist\n  ALLOWED_ORIGINS?: string;\n};\n\ntype ErrorCode =\n  | \"unauthorized\"\n  | \"forbidden\"\n  | \"not_found\"\n  | \"rate_limited\"\n  | \"invalid_request\"\n  | \"internal\";\n\ntype ApiError = { error: { code: ErrorCode; message: string; request_id: string } };\n\nfunction corsHeaders(req: Request, env: Env) {\n  const origin = req.headers.get(\"Origin\") || \"\";\n  const allowed = (env.ALLOWED_ORIGINS ?? \"https://haiphen.io,https://www.haiphen.io,https://app.haiphen.io,https://auth.haiphen.io\")\n    .split(\",\")\n    .map(s => s.trim());\n\n  const o = allowed.includes(origin) ? origin : \"https://haiphen.io\";\n  return {\n    \"Access-Control-Allow-Origin\": o,\n    \"Access-Control-Allow-Credentials\": \"true\",\n    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization, X-Admin-Token\",\n    \"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\n    \"Vary\": \"Origin\"\n  };\n}\n\nfunction withReqId(headers: Headers, requestId: string) {\n  headers.set(\"X-Request-Id\", requestId);\n  return headers;\n}\n\nfunction err(code: ErrorCode, message: string, requestId: string, status: number, extraHeaders?: Record<string, string>) {\n  const body: ApiError = { error: { code, message, request_id: requestId } };\n  const h = new Headers({ \"Content-Type\": \"application/json\", ...(extraHeaders ?? {}) });\n  withReqId(h, requestId);\n  return new Response(JSON.stringify(body, null, 2), { status, headers: h });\n}\n\nfunction okJson(data: unknown, requestId: string, headers?: Record<string, string>) {\n  const h = new Headers({ \"Content-Type\": \"application/json\", ...(headers ?? {}) });\n  withReqId(h, requestId);\n  return new Response(JSON.stringify(data, null, 2), { status: 200, headers: h });\n}\n\nfunction bearer(req: Request): string | null {\n  const h = req.headers.get(\"Authorization\") || \"\";\n  const m = h.match(/^Bearer\\s+(.+)$/i);\n  return m?.[1]?.trim() ?? null;\n}\n\nfunction b64urlToBytes(b64url: string): Uint8Array {\n  const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4);\n  const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const raw = atob(b64);\n  const out = new Uint8Array(raw.length);\n  for (let i = 0; i < raw.length; i++) out[i] = raw.charCodeAt(i);\n  return out;\n}\n\nfunction b64urlToString(b64url: string): string {\n  const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4);\n  const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\");\n  return atob(b64);\n}\n\nasync function ensureUser(env: Env, userLogin: string) {\n  await env.DB.prepare(`INSERT OR IGNORE INTO users(user_login) VALUES (?)`).bind(userLogin).run();\n  await env.DB.prepare(`\n    INSERT OR IGNORE INTO plans(user_login, plan, active) VALUES (?, 'free', 1)\n  `).bind(userLogin).run();\n}\n\nasync function getPlan(env: Env, userLogin: string): Promise<\"free\" | \"pro\" | \"enterprise\"> {\n  // cache for speed\n  const cacheKey = `plan:${userLogin}`;\n  const cached = await env.CACHE_KV.get(cacheKey);\n  if (cached === \"free\" || cached === \"pro\" || cached === \"enterprise\") return cached;\n\n  const row = await env.DB.prepare(`SELECT plan, active FROM plans WHERE user_login = ?`).bind(userLogin).first<{ plan: string; active: number }>();\n  const plan = (row?.active ? row.plan : \"free\") as any;\n  const normalized: \"free\" | \"pro\" | \"enterprise\" =\n    plan === \"pro\" || plan === \"enterprise\" ? plan : \"free\";\n\n  await env.CACHE_KV.put(cacheKey, normalized, { expirationTtl: 300 });\n  return normalized;\n}\n\nfunction planToRateLimit(plan: \"free\" | \"pro\" | \"enterprise\"): RateLimitPlan {\n  if (plan === \"pro\") return { limitPerMinute: 600, burst: 60 };\n  if (plan === \"enterprise\") return { limitPerMinute: 6000, burst: 600 };\n  return { limitPerMinute: 60, burst: 10 };\n}\n\nfunction planToEntitlements(plan: \"free\" | \"pro\" | \"enterprise\") {\n  const paid = plan === \"pro\" || plan === \"enterprise\";\n\n  // Decide what \"free\" can do. I\u2019m assuming:\n  // - docs page itself is public\n  // - API/RSS require paid (or at least an issued key + scopes)\n  // Adjust as you like.\n  return {\n    active: paid,\n    plan,\n    features: {\n      docs: true,          // docs page should render\n      api: paid,           // request access / try-it gating\n      rss: paid,           // rss endpoints\n      services: paid,      // whatever else you gate\n      trade_engine: paid,\n    }\n  };\n}\n\nasync function consumeRateLimit(env: Env, apiKeyHash: string, plan: \"free\" | \"pro\" | \"enterprise\", cost = 1) {\n  const id = env.RATE_LIMITER.idFromName(apiKeyHash);\n  const stub = env.RATE_LIMITER.get(id);\n  const res = await stub.fetch(\"https://rate-limiter/consume\", {\n    method: \"POST\",\n    body: JSON.stringify({ plan: planToRateLimit(plan), cost })\n  });\n  const data = await res.json() as { allowed: boolean; remaining: number; limit: number; resetMs: number };\n  return data;\n}\n\ntype KeyAuth = { user_login: string; scopes: string[]; key_id: string; plan: \"free\" | \"pro\" | \"enterprise\"; key_hash: string };\n\nasync function authApiKey(req: Request, env: Env, requestId: string): Promise<KeyAuth> {\n  const token = bearer(req);\n  if (!token) throw err(\"unauthorized\", \"Missing or invalid API key\", requestId, 401);\n\n  // fast revocation check (KV)\n  const tokenHash = await sha256Hex(`${token}.${env.API_KEY_PEPPER}`);\n  const revoked = await env.REVOKE_KV.get(`revoked:${tokenHash}`);\n  if (revoked) throw err(\"unauthorized\", \"Missing or invalid API key\", requestId, 401);\n\n  // lookup\n  const row = await env.DB\n    .prepare(`SELECT key_id, user_login, scopes, status FROM api_keys WHERE key_hash = ?`)\n    .bind(tokenHash)\n    .first<{ key_id: string; user_login: string; scopes: string; status: string }>();\n\n  if (!row || row.status !== \"active\") throw err(\"unauthorized\", \"Missing or invalid API key\", requestId, 401);\n\n  const plan = await getPlan(env, row.user_login);\n\n  // rate limit per key\n  const rl = await consumeRateLimit(env, tokenHash, plan, 1);\n  if (!rl.allowed) {\n    const resetSeconds = Math.ceil((rl.resetMs - Date.now()) / 1000);\n    throw err(\n      \"rate_limited\",\n      \"Rate limit exceeded\",\n      requestId,\n      429,\n      {\n        \"Retry-After\": String(Math.max(1, resetSeconds)),\n        \"X-RateLimit-Limit\": String(rl.limit),\n        \"X-RateLimit-Remaining\": String(Math.max(0, rl.remaining)),\n        \"X-RateLimit-Reset\": String(Math.floor(rl.resetMs / 1000))\n      }\n    );\n  }\n\n  // update last_used_at (best-effort)\n  env.DB.prepare(`UPDATE api_keys SET last_used_at = strftime('%Y-%m-%dT%H:%M:%fZ','now') WHERE key_id = ?`)\n    .bind(row.key_id)\n    .run()\n    .catch(() => {});\n\n  const scopes = JSON.parse(row.scopes) as string[];\n  return { user_login: row.user_login, scopes, key_id: row.key_id, plan, key_hash: tokenHash };\n}\n\nfunction requireScope(scopes: string[], needed: string, requestId: string) {\n  if (!scopes.includes(needed)) throw err(\"forbidden\", \"Insufficient scope\", requestId, 403);\n}\n\nasync function authCookieUser(req: Request, env: Env, requestId: string): Promise<{ user_login: string }> {\n  try {\n    const user = await requireUserFromAuthCookie(req, env.JWT_SECRET);\n    // Optional: mirror revocation if you want (jti is available in auth.ts claims currently only internally)\n    return { user_login: user.login };\n  } catch (e: any) {\n    // Normalize to your API error format\n    throw err(\"unauthorized\", \"Unauthorized\", requestId, 401);\n  }\n}\n\nfunction parseDateParam(s: string | null): string | null {\n  if (!s) return null;\n  if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(s)) return null;\n  return s;\n}\n\nasync function latestDate(env: Env): Promise<string | null> {\n  const row = await env.DB.prepare(`SELECT date FROM metrics_daily ORDER BY date DESC LIMIT 1`).first<{ date: string }>();\n  return row?.date ?? null;\n}\n\nasync function getDaily(env: Env, date: string) {\n  const row = await env.DB.prepare(`SELECT * FROM metrics_daily WHERE date = ?`).bind(date).first<{\n    date: string;\n    updated_at: string;\n    headline: string;\n    summary: string;\n    rows_json: string;\n    overlay_json: string;\n  }>();\n\n  if (!row) return null;\n\n  return {\n    date: row.date,\n    updated_at: row.updated_at,\n    headline: row.headline,\n    summary: row.summary,\n    rows: JSON.parse(row.rows_json),\n    overlay: JSON.parse(row.overlay_json)\n  };\n}\n\nasync function handleOptions(req: Request, env: Env) {\n  const requestId = uuid();\n  return new Response(null, { status: 204, headers: corsHeaders(req, env) as any });\n}\n\nasync function route(req: Request, env: Env): Promise<Response> {\n  const requestId = uuid();\n  const url = new URL(req.url);\n\n  if (req.method === \"OPTIONS\") return new Response(null, { status: 204, headers: corsHeaders(req, env) as any });\n\n  // normalize: everything is under /v1\n  if (!url.pathname.startsWith(\"/v1/\")) {\n    return err(\"not_found\", \"Not found\", requestId, 404, corsHeaders(req, env));\n  }\n\n  // ---- health ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/health\") {\n    return okJson(\n      { ok: true, time: new Date().toISOString(), version: \"v1.0.0\" },\n      requestId,\n      corsHeaders(req, env)\n    );\n  }\n\n  // ---- whoami / me (cookie auth) ----\n  if (req.method === \"GET\" && (url.pathname === \"/v1/whoami\" || url.pathname === \"/v1/me\")) {\n    const u = await authCookieUser(req, env, requestId);\n    await ensureUser(env, u.user_login);\n\n    const plan = await getPlan(env, u.user_login);\n    const entitlements = planToEntitlements(plan);\n\n    // Latest active key (metadata only \u2014 NEVER return raw api_key here)\n    const key = await env.DB.prepare(`\n      SELECT key_id, key_prefix, scopes, status, created_at, last_used_at\n      FROM api_keys\n      WHERE user_login = ? AND status = 'active'\n      ORDER BY created_at DESC\n      LIMIT 1\n    `).bind(u.user_login).first<{\n      key_id: string;\n      key_prefix: string;\n      scopes: string;\n      status: string;\n      created_at: string;\n      last_used_at: string | null;\n    }>();\n\n    return okJson({\n      user_login: u.user_login,\n      plan,                 // keep for back-compat\n      entitlements,         // \u2705 this is what your front-end expects\n      api_key: key ? {\n        key_id: key.key_id,\n        key_prefix: key.key_prefix,\n        scopes: (() => { try { return JSON.parse(key.scopes) } catch { return [] } })(),\n        status: key.status,\n        created_at: key.created_at,\n        last_used_at: key.last_used_at\n      } : null\n    }, requestId, corsHeaders(req, env));\n  }\n\n  if (req.method === \"POST\" && url.pathname === \"/v1/admin/metrics/upsert\") {\n    const tok = req.headers.get(\"X-Admin-Token\") || \"\";\n    if (!safeEqual(tok, env.ADMIN_TOKEN)) return err(\"forbidden\", \"Forbidden\", requestId, 403, corsHeaders(req, env));\n\n    const body = await req.json().catch(() => null) as any;\n    if (!body) return err(\"invalid_request\", \"Invalid JSON body\", requestId, 400, corsHeaders(req, env));\n\n    try {\n      let payload: unknown = body;\n\n      if (typeof body?.url === \"string\") {\n        const r = await fetch(body.url, { headers: { \"Accept\": \"application/json\" } });\n        if (!r.ok) return err(\"invalid_request\", `Failed to fetch url (status ${r.status})`, requestId, 400, corsHeaders(req, env));\n        payload = await r.json();\n      }\n\n      const normalized = normalizeTradesJson(payload);\n      await upsertMetricsDaily(env, normalized);\n      await env.CACHE_KV.delete(\"metrics:latest\").catch(() => {});\n\n      return okJson({ ok: true, date: normalized.date, updated_at: normalized.updated_at }, requestId, corsHeaders(req, env));\n    } catch (e: any) {\n      console.error(\"\u274C admin/metrics/upsert failed:\", e);\n      return err(\"invalid_request\", `Upsert failed: ${String(e?.message ?? e)}`, requestId, 400, corsHeaders(req, env));\n    }\n  }\n\n  // ---- ADMIN: debug auth cookie verification ----\n  // GET /v1/admin/debug/auth-cookie\n  if (req.method === \"GET\" && url.pathname === \"/v1/admin/debug/auth-cookie\") {\n    const tok = req.headers.get(\"X-Admin-Token\") || \"\";\n    if (!safeEqual(tok, env.ADMIN_TOKEN)) return err(\"forbidden\", \"Forbidden\", requestId, 403, corsHeaders(req, env));\n\n    const rawCookie = req.headers.get(\"Cookie\") || \"\";\n    const token = rawCookie.match(/(?:^|;\\s*)auth=([^;]+)/)?.[1] ?? null;\n\n    if (!token) return okJson({ ok: false, reason: \"missing_auth_cookie\", rawCookiePresent: Boolean(rawCookie) }, requestId, corsHeaders(req, env));\n\n    const parts = token.split(\".\");\n    if (parts.length !== 3) return okJson({ ok: false, reason: \"malformed_jwt\", parts: parts.length }, requestId, corsHeaders(req, env));\n\n    const [h, p] = parts;\n\n    // decode payload WITHOUT verification (debug only)\n    const b64urlToString = (b64url: string) => {\n      const pad = \"=\".repeat((4 - (b64url.length % 4)) % 4);\n      const b64 = (b64url + pad).replace(/-/g, \"+\").replace(/_/g, \"/\");\n      return atob(b64);\n    };\n\n    let payload: any = null;\n    try { payload = JSON.parse(b64urlToString(p)); } catch {}\n\n    // try real verification via your canonical helper\n    let verified = false;\n    let error = null as string | null;\n    try {\n      const user = await requireUserFromAuthCookie(req, env.JWT_SECRET);\n      verified = true;\n      return okJson({ ok: true, verified, user, payload }, requestId, corsHeaders(req, env));\n    } catch (e: any) {\n      error = String(e?.message ?? e);\n    }\n\n    return okJson({ ok: false, verified, error, payload }, requestId, corsHeaders(req, env));\n  }\n  // ---- metrics/daily ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/metrics/daily\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"metrics:read\", requestId);\n\n    const dateParam = parseDateParam(url.searchParams.get(\"date\"));\n    const date = dateParam ?? (await latestDate(env));\n    if (!date) return err(\"not_found\", \"No metrics available\", requestId, 404, corsHeaders(req, env));\n\n    const daily = await getDaily(env, date);\n    if (!daily) return err(\"not_found\", \"Metrics not found\", requestId, 404, corsHeaders(req, env));\n\n    return okJson(daily, requestId, corsHeaders(req, env));\n  }\n\n  // ---- metrics/kpis ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/metrics/kpis\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"metrics:read\", requestId);\n\n    const dateParam = parseDateParam(url.searchParams.get(\"date\"));\n    const date = dateParam ?? (await latestDate(env));\n    if (!date) return err(\"not_found\", \"No metrics available\", requestId, 404, corsHeaders(req, env));\n\n    const items = await getKpis(env, date);\n    return okJson({ date, items }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- metrics/series ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/metrics/series\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"metrics:read\", requestId);\n\n    const kpi = String(url.searchParams.get(\"kpi\") ?? \"\").trim();\n    if (!kpi) return err(\"invalid_request\", \"Missing kpi\", requestId, 400, corsHeaders(req, env));\n\n    const dateParam = parseDateParam(url.searchParams.get(\"date\"));\n    const date = dateParam ?? (await latestDate(env));\n    if (!date) return err(\"not_found\", \"No metrics available\", requestId, 404, corsHeaders(req, env));\n\n    const from = url.searchParams.get(\"from\") || undefined;\n    const to = url.searchParams.get(\"to\") || undefined;\n    const limit = Number(url.searchParams.get(\"limit\") ?? \"500\");\n\n    const points = await getSeries(env, date, kpi, from, to, limit);\n    return okJson({ date, kpi, points }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- metrics/extremes ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/metrics/extremes\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"metrics:read\", requestId);\n\n    const kpi = String(url.searchParams.get(\"kpi\") ?? \"\").trim();\n    if (!kpi) return err(\"invalid_request\", \"Missing kpi\", requestId, 400, corsHeaders(req, env));\n\n    const sideRaw = String(url.searchParams.get(\"side\") ?? \"hi\").trim().toLowerCase();\n    const side = (sideRaw === \"lo\" ? \"lo\" : \"hi\") as \"hi\" | \"lo\";\n\n    const dateParam = parseDateParam(url.searchParams.get(\"date\"));\n    const date = dateParam ?? (await latestDate(env));\n    if (!date) return err(\"not_found\", \"No metrics available\", requestId, 404, corsHeaders(req, env));\n\n    const limit = Number(url.searchParams.get(\"limit\") ?? \"10\");\n    const items = await getExtremes(env, date, kpi, side, limit);\n\n    return okJson({ date, kpi, side, items }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- metrics/portfolio-assets ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/metrics/portfolio-assets\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"metrics:read\", requestId);\n\n    const dateParam = parseDateParam(url.searchParams.get(\"date\"));\n    const date = dateParam ?? (await latestDate(env));\n    if (!date) return err(\"not_found\", \"No metrics available\", requestId, 404, corsHeaders(req, env));\n\n    const symbol = url.searchParams.get(\"symbol\") || undefined;\n    const limit = Number(url.searchParams.get(\"limit\") ?? \"200\");\n\n    const items = await getPortfolioAssets(env, date, symbol, limit);\n    return okJson({ date, symbol: symbol ?? null, items }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- metrics/dates ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/metrics/dates\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"metrics:read\", requestId);\n\n    const limitRaw = url.searchParams.get(\"limit\");\n    const limit = Math.min(200, Math.max(1, Number(limitRaw ?? \"50\")));\n    const cursor = url.searchParams.get(\"cursor\"); // date string\n\n    let stmt: D1PreparedStatement;\n    if (cursor && /^\\d{4}-\\d{2}-\\d{2}$/.test(cursor)) {\n      stmt = env.DB.prepare(`SELECT date FROM metrics_daily WHERE date < ? ORDER BY date DESC LIMIT ?`).bind(cursor, limit);\n    } else {\n      stmt = env.DB.prepare(`SELECT date FROM metrics_daily ORDER BY date DESC LIMIT ?`).bind(limit);\n    }\n\n    const rows = await stmt.all<{ date: string }>();\n    const items = (rows.results ?? []).map(r => ({ date: r.date }));\n    const next_cursor = items.length === limit ? items[items.length - 1].date : null;\n\n    return okJson({ items, next_cursor }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- rss ----\n  if (req.method === \"GET\" && url.pathname === \"/v1/rss/daily\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"rss:read\", requestId);\n\n    const dateParam = parseDateParam(url.searchParams.get(\"date\"));\n    const date = dateParam ?? (await latestDate(env));\n    if (!date) return err(\"not_found\", \"No metrics available\", requestId, 404, corsHeaders(req, env));\n\n    const daily = await getDaily(env, date);\n    if (!daily) return err(\"not_found\", \"Metrics not found\", requestId, 404, corsHeaders(req, env));\n\n    const xml = buildRss(daily as any);\n    const h = new Headers({ \"Content-Type\": \"application/rss+xml; charset=utf-8\", ...corsHeaders(req, env) });\n    withReqId(h, requestId);\n    return new Response(xml, { status: 200, headers: h });\n  }\n\n  // ---- ADMIN: upsert metrics payload (direct JSON or fetch from URL) ----\n  // POST /v1/admin/metrics/upsert\n  // headers: X-Admin-Token\n  // body: either full trades.json payload OR { url: \"https://haiphen.io/docs/assets/trades/trades.json\" }\n  if (req.method === \"POST\" && url.pathname === \"/v1/admin/metrics/upsert\") {\n    const tok = req.headers.get(\"X-Admin-Token\") || \"\";\n    if (!safeEqual(tok, env.ADMIN_TOKEN)) return err(\"forbidden\", \"Forbidden\", requestId, 403, corsHeaders(req, env));\n\n    const body = await req.json().catch(() => null) as any;\n    if (!body) return err(\"invalid_request\", \"Invalid JSON body\", requestId, 400, corsHeaders(req, env));\n\n    let payload: unknown = body;\n\n    // Optional fetch mode\n    if (typeof body?.url === \"string\") {\n      const u = body.url as string;\n      if (!/^https:\\/\\/.+/i.test(u)) return err(\"invalid_request\", \"url must be https://\", requestId, 400, corsHeaders(req, env));\n\n      const r = await fetch(u, { headers: { \"Accept\": \"application/json\" } });\n      if (!r.ok) return err(\"invalid_request\", `Failed to fetch url (status ${r.status})`, requestId, 400, corsHeaders(req, env));\n      payload = await r.json();\n    }\n\n    const normalized = normalizeTradesJson(payload);\n    await upsertMetricsDaily(env, normalized);\n\n    // Optional: bust latest cache so API sees it immediately\n    await env.CACHE_KV.delete(\"metrics:latest\").catch(() => {});\n\n    return okJson({ ok: true, date: normalized.date, updated_at: normalized.updated_at }, requestId, corsHeaders(req, env));\n  }\n  // ---- webhooks ----\n  if (req.method === \"POST\" && url.pathname === \"/v1/webhooks\") {\n    const auth = await authApiKey(req, env, requestId);\n    requireScope(auth.scopes, \"webhooks:write\", requestId);\n    if (auth.plan === \"free\") throw err(\"forbidden\", \"Webhooks require Pro or Enterprise\", requestId, 403);\n\n    const body = await req.json().catch(() => null) as null | { url: string; events: string[] };\n    if (!body?.url || !Array.isArray(body.events) || body.events.length === 0) {\n      return err(\"invalid_request\", \"Invalid body\", requestId, 400, corsHeaders(req, env));\n    }\n    if (!/^https:\\/\\/.+/i.test(body.url)) return err(\"invalid_request\", \"Webhook url must be https://\", requestId, 400, corsHeaders(req, env));\n\n    const webhook_id = uuid();\n    const secret = uuid().replaceAll(\"-\", \"\") + (env.WEBHOOK_SALT ?? \"\");\n\n    await env.DB.prepare(`\n      INSERT INTO webhooks(webhook_id, user_login, url, events_json, secret)\n      VALUES (?, ?, ?, ?, ?)\n    `).bind(webhook_id, auth.user_login, body.url, json(body.events), secret).run();\n\n    return okJson(\n      { webhook_id, url: body.url, events: body.events },\n      requestId,\n      corsHeaders(req, env)\n    );\n  }\n\n  // ---- key issuance (cookie-auth; used by your app UI after login + Stripe) ----\n  // POST /v1/keys/issue  body: { scopes?: string[] }\n  if (req.method === \"POST\" && url.pathname === \"/v1/keys/issue\") {\n    const u = await authCookieUser(req, env, requestId);\n    await ensureUser(env, u.user_login);\n\n    const plan = await getPlan(env, u.user_login);\n    // Gate: only allow issuance if they\u2019re \u201Cpaid\u201D for Pro scope sets, etc.\n    // Start simple: everyone can get a Free key. Pro features are enforced by plan at request-time.\n\n    const body = await req.json().catch(() => ({})) as { scopes?: string[] };\n    const scopes = Array.isArray(body.scopes) && body.scopes.length > 0\n      ? body.scopes\n      : [\"metrics:read\", \"rss:read\"]; // default minimal\n\n    // validate scopes\n    const allowedScopes = new Set([\"metrics:read\", \"rss:read\", \"webhooks:write\"]);\n    for (const s of scopes) {\n      if (!allowedScopes.has(s)) return err(\"invalid_request\", `Unknown scope: ${s}`, requestId, 400, corsHeaders(req, env));\n      if (s === \"webhooks:write\" && plan === \"free\") {\n        return err(\"forbidden\", \"webhooks:write requires Pro or Enterprise\", requestId, 403, corsHeaders(req, env));\n      }\n    }\n\n    const key_id = uuid();\n    const raw = `hp_live_${uuid().replaceAll(\"-\", \"\")}${uuid().replaceAll(\"-\", \"\")}`; // long enough\n    const key_hash = await sha256Hex(`${raw}.${env.API_KEY_PEPPER}`);\n    const key_prefix = raw.slice(0, 16);\n\n    await env.DB.prepare(`\n      INSERT INTO api_keys(key_id, user_login, key_prefix, key_hash, scopes, status)\n      VALUES (?, ?, ?, ?, ?, 'active')\n    `).bind(key_id, u.user_login, key_prefix, key_hash, json(scopes)).run();\n\n    // return raw key ONLY ONCE\n    return okJson(\n      { api_key: raw, key_id, key_prefix, scopes },\n      requestId,\n      corsHeaders(req, env)\n    );\n  }\n\n  // ---- key rotation (cookie-auth): create new, optionally revoke old by key_id ----\n  // POST /v1/keys/rotate  body: { revoke_key_id?: string, scopes?: string[] }\n  if (req.method === \"POST\" && url.pathname === \"/v1/keys/rotate\") {\n    const u = await authCookieUser(req, env, requestId);\n    await ensureUser(env, u.user_login);\n\n    const body = await req.json().catch(() => ({})) as { revoke_key_id?: string; scopes?: string[] };\n    const revokeKeyId = body.revoke_key_id;\n\n    // issue new\n    const issueRes = await route(new Request(req.url.replace(\"/v1/keys/rotate\", \"/v1/keys/issue\"), {\n      method: \"POST\",\n      headers: req.headers,\n      body: JSON.stringify({ scopes: body.scopes })\n    }), env);\n\n    // revoke old if requested (only if belongs to user)\n    if (revokeKeyId) {\n      const row = await env.DB.prepare(`SELECT key_hash FROM api_keys WHERE key_id = ? AND user_login = ? AND status = 'active'`)\n        .bind(revokeKeyId, u.user_login)\n        .first<{ key_hash: string }>();\n\n      if (row?.key_hash) {\n        await env.DB.prepare(`UPDATE api_keys SET status='revoked', revoked_at=strftime('%Y-%m-%dT%H:%M:%fZ','now') WHERE key_id = ?`)\n          .bind(revokeKeyId)\n          .run();\n        await env.REVOKE_KV.put(`revoked:${row.key_hash}`, \"1\", { expirationTtl: 60 * 60 * 24 * 365 });\n      }\n    }\n\n    return issueRes;\n  }\n\n  // ---- key revoke (cookie-auth): revoke by key_id ----\n  // POST /v1/keys/revoke body: { key_id: string }\n  if (req.method === \"POST\" && url.pathname === \"/v1/keys/revoke\") {\n    const u = await authCookieUser(req, env, requestId);\n    const body = await req.json().catch(() => null) as null | { key_id: string };\n    if (!body?.key_id) return err(\"invalid_request\", \"Missing key_id\", requestId, 400, corsHeaders(req, env));\n\n    const row = await env.DB.prepare(`SELECT key_hash FROM api_keys WHERE key_id = ? AND user_login = ? AND status='active'`)\n      .bind(body.key_id, u.user_login)\n      .first<{ key_hash: string }>();\n\n    if (!row) return err(\"not_found\", \"Key not found\", requestId, 404, corsHeaders(req, env));\n\n    await env.DB.prepare(`UPDATE api_keys SET status='revoked', revoked_at=strftime('%Y-%m-%dT%H:%M:%fZ','now') WHERE key_id = ?`)\n      .bind(body.key_id)\n      .run();\n    await env.REVOKE_KV.put(`revoked:${row.key_hash}`, \"1\", { expirationTtl: 60 * 60 * 24 * 365 });\n\n    return okJson({ ok: true }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- ADMIN: set plan/entitlement ----\n  // POST /v1/admin/plan body: { user_login, plan }\n  if (req.method === \"POST\" && url.pathname === \"/v1/admin/plan\") {\n    const tok = req.headers.get(\"X-Admin-Token\") || \"\";\n    if (!safeEqual(tok, env.ADMIN_TOKEN)) return err(\"forbidden\", \"Forbidden\", requestId, 403, corsHeaders(req, env));\n\n    const body = await req.json().catch(() => null) as null | { user_login: string; plan: \"free\" | \"pro\" | \"enterprise\" };\n    if (!body?.user_login || !body?.plan) return err(\"invalid_request\", \"Invalid body\", requestId, 400, corsHeaders(req, env));\n\n    await ensureUser(env, body.user_login);\n    await env.DB.prepare(`\n      INSERT INTO plans(user_login, plan, active, updated_at)\n      VALUES (?, ?, 1, strftime('%Y-%m-%dT%H:%M:%fZ','now'))\n      ON CONFLICT(user_login) DO UPDATE SET plan=excluded.plan, active=1, updated_at=excluded.updated_at\n    `).bind(body.user_login, body.plan).run();\n\n    await env.CACHE_KV.put(`plan:${body.user_login}`, body.plan, { expirationTtl: 300 });\n\n    return okJson({ ok: true }, requestId, corsHeaders(req, env));\n  }\n\n  // ---- ADMIN: publish webhooks for a date (simple fanout) ----\n  // POST /v1/admin/publish body: { date: \"YYYY-MM-DD\", event?: \"metrics.published\" }\n  if (req.method === \"POST\" && url.pathname === \"/v1/admin/publish\") {\n    const tok = req.headers.get(\"X-Admin-Token\") || \"\";\n    if (!safeEqual(tok, env.ADMIN_TOKEN)) return err(\"forbidden\", \"Forbidden\", requestId, 403, corsHeaders(req, env));\n\n    const body = await req.json().catch(() => null) as null | { date: string; event?: string };\n    const date = parseDateParam(body?.date ?? null);\n    if (!date) return err(\"invalid_request\", \"Invalid date\", requestId, 400, corsHeaders(req, env));\n    const event = body?.event ?? \"metrics.published\";\n\n    const daily = await getDaily(env, date);\n    if (!daily) return err(\"not_found\", \"Metrics not found\", requestId, 404, corsHeaders(req, env));\n\n    // all active webhooks that include this event\n    const hooks = await env.DB.prepare(`SELECT webhook_id, url, events_json, secret FROM webhooks WHERE status='active'`).all<{\n      webhook_id: string; url: string; events_json: string; secret: string;\n    }>();\n\n    const payload = { event, data: daily, sent_at: new Date().toISOString() };\n    const payloadStr = JSON.stringify(payload);\n\n    const deliveries = await Promise.all((hooks.results ?? []).map(async (h) => {\n      const events = JSON.parse(h.events_json) as string[];\n      if (!events.includes(event)) return { webhook_id: h.webhook_id, skipped: true };\n\n      const sig = await hmacSha256Hex(h.secret, payloadStr);\n      const delivery_id = uuid();\n\n      try {\n        const res = await fetch(h.url, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Haiphen-Signature\": `sha256=${sig}`,\n            \"X-Haiphen-Event\": event,\n            \"X-Request-Id\": requestId\n          },\n          body: payloadStr\n        });\n\n        await env.DB.prepare(`\n          INSERT INTO webhook_deliveries(delivery_id, webhook_id, event, date, request_id, status_code, error)\n          VALUES (?, ?, ?, ?, ?, ?, ?)\n        `).bind(delivery_id, h.webhook_id, event, date, requestId, res.status, null).run();\n\n        return { webhook_id: h.webhook_id, status: res.status };\n      } catch (e: any) {\n        await env.DB.prepare(`\n          INSERT INTO webhook_deliveries(delivery_id, webhook_id, event, date, request_id, status_code, error)\n          VALUES (?, ?, ?, ?, ?, ?, ?)\n        `).bind(delivery_id, h.webhook_id, event, date, requestId, null, String(e?.message ?? e)).run();\n\n        return { webhook_id: h.webhook_id, error: String(e?.message ?? e) };\n      }\n    }));\n\n    return okJson({ ok: true, event, date, deliveries }, requestId, corsHeaders(req, env));\n  }\n\n  return err(\"not_found\", \"Not found\", requestId, 404, corsHeaders(req, env));\n}\n\nexport default {\n  async fetch(req: Request, env: Env): Promise<Response> {\n    try {\n      return await route(req, env);\n    } catch (e: any) {\n      // \u2705 If inner code threw a Response, return it as-is.\n      if (e instanceof Response) return e;\n\n      const requestId = uuid();\n      console.error(\"\u274C Unhandled error:\", e);\n      return err(\"internal\", \"Internal error\", requestId, 500, corsHeaders(req, env));\n    }\n  }\n};", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/jks142857/Desktop/haiphen-aboutme/haiphen-api/src/index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/Users/jks142857/Desktop/haiphen-aboutme/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/Users/jks142857/Desktop/haiphen-aboutme/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/jks142857/Desktop/haiphen-aboutme/haiphen-api/src/index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/jks142857/Desktop/haiphen-aboutme/haiphen-api/.wrangler/tmp/bundle-kjJbIs/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/Users/jks142857/Desktop/haiphen-aboutme/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/jks142857/Desktop/haiphen-aboutme/haiphen-api/.wrangler/tmp/bundle-kjJbIs/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/jks142857/Desktop/haiphen-aboutme/haiphen-api/.wrangler/tmp/bundle-kjJbIs/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["rows"]
}
