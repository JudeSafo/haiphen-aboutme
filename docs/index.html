	<!DOCTYPE html>
	<html lang="en">
	<head>
	  <meta charset="UTF-8" />
	  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	  <title>Haiphen ‚Äî Edge Protocol Intelligence Platform</title>
	   <!-- Basic SEO -->
	  <meta name="description" content="Haiphen is a signals intelligence    open-source, scalable infrastructure for NLP, machine learning, embedded systems, and operational security." />
	  <meta name="author" content="J. S." />
	  <meta name="keywords" content="Haiphen, Signals intelligence, NLP, machine learning consulting, open source infrastructure, cybersecurity, Jude Safo" />

	  <!-- Open Graph for LinkedIn/Facebook -->
	  <meta property="og:title" content="Haiphen | Signals Intelligence & Automated Trading Infrastructure" />
	  <meta property="og:description" content="Signals intelligence + production-grade ML/NLP infrastructure, including automated trading telemetry, risk analytics, and event-driven pipelines. Build with us." />
	  <meta property="og:image" content="https://haiphen.io/assets/robot_haiphen.png" />
	  <meta property="og:url" content="https://haiphen.io" />
	  <meta property="og:type" content="website" />

	  <!-- Twitter Card -->
	  <meta name="twitter:card" content="summary_large_image" />
	  <meta name="twitter:title" content="Haiphen - Open Source Signals Intelligence Engineering" />
	  <meta name="twitter:description" content="Custom signal processing + ML/NLP infrastructure. We build real systems for real problems. API everything." />
	  <meta name="twitter:image" content="https://haiphen.io/assets/robot_haiphen.png" />
	  <link rel="canonical" href="https://haiphen.io/">
	  <link rel="stylesheet" href="assets/base.css" />

	  <script src="components/headers/site-header.js"></script>
	  <script src="components/headers/session-profile-template.js"></script>
	  <script src="components/sidebar/site-sidebar.js"></script>
	  <script src="components/sidebar/sidebar-nav.js"></script>
	  <script src="components/section-menu/section-menu.js"></script>
	  <script src="components/footers/site-footer.js"></script>
	  <script src="components/trades-overlay/trades-overlay.js"></script>
	  <script src="components/services-plans/services-plans.js"></script>
	  <script src="components/services/services-section.js"></script>
	  <script src="components/faq/faq.js"></script>
	  <script src="components/site-search/site-search.js"></script>
	  <script src="components/site-search/site-search-index.js"></script>
	  <script src="components/gating/auth-session.js" defer></script>
      <script src="components/gating/entitlement-gate.js" defer></script>
	  <script src="components/gating/gate-shim.js" defer></script>	  
	  <script src="components/api-docs/api-docs.js"></script>
	  <script src="components/api-docs/api-access.js"></script>
	  <script src="components/contact-form/contact-form.js"></script>
	  <script src="components/mission/mission.js"></script>
 	  <script src="components/cohort/cohort.js"></script>
 	  <script src="components/cohort/cohort-banner.js" defer></script>
	  <link rel="stylesheet" href="components/cohort/cohort-banner.css" />
	  <link rel="stylesheet" href="components/cohort/cohort.css" />	  
	  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
	  <link rel="stylesheet" href="components/contact-form/contact-form.css" />
	  <link rel="stylesheet" href="components/terms-gate/terms-gate.css" data-terms-gate-css="1" />
	  <script src="components/terms-gate/terms-gate.js"></script>
	  <script src="components/terms-gate/checkout-router.js"></script>
	  <script src="components/terms-gate/tos-resume.js"></script>
      <script src="components/hero-device-launcher/hero-device-launcher.js"></script>
      <link rel="stylesheet" href="components/hero-device-launcher/hero-device-launcher.css" />
	  <script defer src="components/profile/profile.js"></script>
	  <script defer src="components/getting-started/getting-started.js"></script>
	  <link rel="stylesheet" href="components/getting-started/getting-started.css" />
	  <script src="components/checkout-success/checkout-success.js"></script>
	  <script src="components/cookie-consent/cookie-consent.js"></script>
	  <script src="components/chatbot/chatbot.js"></script>

	  <script>
	    window.HAIPHEN = window.HAIPHEN || {};
	    window.HAIPHEN.TURNSTILE_SITE_KEY = "0x4AAAAAACKr8sUWJUM68QdF"; // site key (public)
	  </script>

	  <!-- üîΩ Structured Data for SEO -->
	  <script type="application/ld+json">
	  {
	    "@context": "https://schema.org",
	    "@type": "Organization",
	    "name": "Haiphen",
	    "url": "https://haiphen.io",
	    "logo": "https://haiphen.io/assets/robot_haiphen.png",
	    "contactPoint": {
	      "@type": "ContactPoint",
	      "telephone": "+1-512-910-4544",
	      "contactType": "Sales",
	      "areaServed": "US",
	      "availableLanguage": ["English"]
	    },
	    "sameAs": [
	      "https://linkedin.com/in/judesafo",
	      "https://github.com/judesafo"
	    ]
	  }
	  </script>

	  <!-- charset, viewport, and title moved to top of <head> -->
	  <style>
	    /* ============================================================
	       Reset & Base Styles
	    ============================================================ */
	    * {
	      box-sizing: border-box;
	      margin: 0;
	      padding: 0;
	    }
	    body {
	      font-family: var(--font-sans);
	      color: var(--text);
	      background: url('./assets/background.svg') no-repeat center center fixed;
	      background-size: cover;
	      padding-top: 70px;
	      min-height: 100vh;
	    }
			    
	    /* ============================================================
	       Fixed Navbar (Top)
	    ============================================================ */
	    nav.navbar {
	      position: fixed;
	      top: 0; left: 0; width: 100%;
	      background: rgba(255, 255, 255, 0.95);
	      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
	      display: flex; align-items: center; justify-content: space-between;
	      padding: 0.5rem 1rem;
	      z-index: 1000;
	    }
	    nav.navbar .logo {
	      cursor: pointer;
	    }
	    nav.navbar .logo img {
	      height: 40px;
	    }
	    nav.navbar .nav-links {
	      display: flex; gap: 1rem;
	    }
	    nav.navbar .nav-links a {
	      text-decoration: none; color: #2c3e50; font-weight: bold;
	      padding: 0.5rem 1rem; transition: background 0.3s ease;
	    }
	    nav.navbar .nav-links a:hover {
	      background: #ecf0f1; border-radius: 4px;
	    }
	    
	    /* ============================================================
	       Hero Section (with solid background for readability)
	    ============================================================ */
	    .hero {
	      background: rgba(255, 255, 255, 0.0);
	      padding: 0; border-radius: 8px;
	      margin-bottom: 4rem;
	    }
	    .hero h1 {
	      font-size: 3rem; color: #2c3e50; margin-bottom: 1rem;
	    }
	    .hero-logo img {
	      max-width: 400px; width: 100%; height: auto;
	      display: block; margin: 0 auto 10px; transform: translateX(-115px) translateY(-55px); /* shift left by 20px */
	    }
	    .hero p {
	      font-size: 1.05rem; color: #555; margin-bottom: 3rem; margin-top: 0rem;  transform: translateX(-110px) translateY(-45px); /* shift left by 20px */
	    }
	    
	    /* Navbar ‚ÄúLogin‚Äù button */
	    nav.navbar .login-btn {
	      background: #5A9BD4;           /* your brand blue */
	      color: #fff;                   /* white text */
	      padding: 0.4rem 0.9rem;        /* a little breathing room */
	      border-radius: 9999px;         /* pill-shape */
	      text-decoration: none;         /* remove underline */
	      font-weight: bold;
	      margin-left: 1rem;             /* space from the other links */
	      transition: background 0.2s ease;
	    }
	    nav.navbar .login-btn:hover {
	      background: #34495e;           /* darker on hover */
	    }    
	    /* ============================================================
	       Section Menu
	    ============================================================ */
	    .section-menu {
	      display: flex;
	      justify-content: center;
	      gap: 1rem;
	      margin-bottom: 5rem;
	      flex-wrap: wrap;
	    }
	    .section-menu button {
	      background: #5A9BD4;
	      color: #fff;
	      border: none;
	      padding: 0.75rem 1.5rem;
	      border-radius: 4px;
	      cursor: pointer;
	      font-size: 1rem;
	      transition: background 0.3s ease;
	    }
	    .section-menu button:hover {
	      background: #34495e;
	    }
	    
	    /* ============================================================
	       Content Widget (Accordion-Like Area)
	    ============================================================ */
	    .content-widget {
	      max-width: 960px; width: 100%;
	      background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
	      padding: 1.5rem;
	      display: none; /* hidden by default */
	      opacity: 0; /* hidden by default */
	      transition: opacity 0.5s ease;
	    }
	    .content-widget.active {
	      display: block; opacity: 1;
	    }
	    body.sidebar-collapsed .content-widget {
	      max-width: none;
	    }
	    
	    /* ============================================================
	       Bottom Left Contact Widget (Profile)
	    ============================================================ */
	    .contact-widget {
	      position: fixed; bottom: 20px; left: 20px;
	      width: 50px; height: 50px; cursor: pointer; z-index: 1000;
	    }
	    .contact-widget img {
	      width: 100%; height: auto; border-radius: 50%;
	      border: 2px solid #2c3e50;
	    }
	    .contact-popup {
	      position: absolute; bottom: 60px; left: 0;
	      background: rgba(255, 255, 255, 0.95); border: 1px solid #2c3e50;
	      border-radius: 4px; padding: 0.5rem 1rem; display: none;
	      white-space: nowrap; font-size: 0.9rem;
	    }
	    .contact-widget:hover .contact-popup {
	      display: block;
	    }



	    /* ============================================================
	       Session Avatar
	    ============================================================ */
	    /* === Session display (replaces Login after auth) === */
	    .session-user {
	      display: inline-flex;
	      align-items: center;
	      gap: 0.4rem;
	      padding: 0.25rem 0.75rem;
	      border-radius: 9999px;
	      border: 2px solid #5A9BD4;
	      background: rgba(90,155,212,0.1);
	      color: #2c3e50;
	      font-size: 0.9rem;
	      font-weight: bold;
	      line-height: 1;
	    }
	    .session-user img {
	      width: 20px;
	      height: 20px;
	      border-radius: 50%;
	    }
	    .session-user .logout-link {
	      margin-left: 0.25rem;
	      font-weight: bold;
	      text-decoration: none;
	      color: #5A9BD4;
	    }
	    .session-user .logout-link:hover {
	      text-decoration: underline;
	      color: #34495e;
	    }

		:root{
		  --sidebar-w: 220px;
		  --header-h: 70px;
		}

		:root{
		  /* 0 when banner is hidden; JS will set to banner height when shown */
		  --cohort-banner-offset: 0px;

		  /* keep your existing look/spacing */
		  --sidebar-top-gap: 22px; /* 92px - 70px = 22px */
		}

		/* Body: reserve space for BOTH banner + header */
		body{
		  padding-top: calc(var(--header-h) + var(--cohort-banner-offset));
		}

		/* Force fixed header down when banner is visible */
		.site-header,
		#site-header .site-header,
		nav.navbar{
		  top: var(--cohort-banner-offset) !important;
		}

		.main-container{
		  min-height: 100vh;
		  display: flex;
		  flex-direction: column;
		  align-items: center;
		  padding: 4rem 2rem;
		  text-align: center;
		}

		/* If sidebar is present on desktop, reserve space consistently */
		@media (min-width: 920px){
		  .main-container{
		    padding-left: calc(2rem + var(--sidebar-w));
		  }
		}  
	    /* ============================================================
	       Service Keys Popup Styling
	    ============================================================ */
	    .service-keys {
	      background-color: #f2f2f2;
	      padding: 1rem;
	      margin-top: 2rem;
	      border-radius: 4px;
	      text-align: left;
	      display: inline-block;
	    }
	    .service-keys strong {
	      margin-right: 0.5rem;
	    }
	    .service-key {
	      position: relative;
	      color: #5A9BD4;
	      text-decoration: none;
	      font-weight: bold;
	      margin-right: 0.5rem;
	      cursor: pointer;
	    }
	    .service-tooltip {
	      display: none;
	      position: absolute;
	      bottom: 120%;
	      left: 50%;
	      transform: translateX(-50%);
	      background: #fff;
	      border: 1px solid #ccc;
	      border-radius: 4px;
	      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
	      padding: 0.5rem;
	      /* Key changes here: */
	      width: 300px;           /* fixed width so all popups are the same size */
	      /* max-width: 100%;    <-- remove this if it conflicts */
	      color: #000;
	      font-weight: normal;
	      text-decoration: none;
	      z-index: 100;
	      white-space: normal;    /* enables line wrapping */
	      word-wrap: break-word;  /* breaks long words if needed */
	      text-align: left;
	    }
	    .service-key:hover .service-tooltip,
	    .service-tooltip:hover {
	      display: block;
	    }

	    /* === Services gallery (NEW) === */
	    .services-gallery-wrapper{
	      max-height:450px;          /* keeps the widget compact */
	      overflow-y:auto;
	      padding-right:.4rem;       /* room for scrollbar */
	      margin-top:2rem;
	    }
	    .services-gallery{
	      display:grid;
	      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
	      gap:1.5rem;
	    }
	    .gallery-item{
	      display:flex;
	      flex-direction:column;
	      align-items:center;
	    }
	    .gallery-item img{
	      width:100%;
	      aspect-ratio:4/3;
	      object-fit:cover;
	      border-radius:8px;
	      box-shadow:0 2px 8px rgba(0,0,0,.08);
	      cursor:pointer;
	      transition:transform .25s ease;
	    }
	    .gallery-item img:hover{transform:scale(1.04);}
	    .gallery-item figcaption{
	      margin-top:.4rem;
	      font-size:.85rem;
	      color:#555;
	      text-align:center;
	    }    
	    /* Lightbox overlay */
	    #lightbox{
	      position:fixed;
	      inset:0;
	      display:none;               /* hidden until opened */
	      align-items:center;
	      justify-content:center;
	      background:rgba(0,0,0,.85);
	      z-index:2000;
	    }
	    #lightbox img{
	      max-width:90%;
	      max-height:90%;
	      border-radius:8px;
	    }    
	    /* ============================================================
	       Step by Step
	    ============================================================ */
	    /* Steps Section */
	    .steps-container {
	      display: flex; justify-content: center; gap: 2rem;
	      margin-bottom: 2rem; flex-wrap: nowrap; width: 100%; max-width: 900px;
	    }
	    .step {
	      flex: 1; min-width: 150px; text-align: center;
	    }
	    .step img {
	      max-width: 100%; height: auto; display: block; margin: 0 auto;
	    }
	    .step p {
	      margin-top: 0.5rem; font-size: 1rem; color: #555;
	    }
	    
	    /* ============================================================
	       OnePager Carousel Styles
	    ============================================================ */
	    .onepager-container {
	      position: relative; display: inline-block;
	      max-width: 800px; width: 100%;
	    }
	    .onepager-container img {
	      width: 100%; display: block;
	    }
	    .onepager-click-zone {
	      position: absolute; top: 0; width: 50%; height: 100%; cursor: pointer;
	    }
	    .onepager-click-left { left: 0; }
	    .onepager-click-right { right: 0; }
	    .onepager-arrow {
	      position: absolute; top: 50%; transform: translateY(-50%);
	      background: rgba(0,0,0,0.2); color: white; border: none;
	      padding: 1rem; cursor: pointer; font-size: 2rem; border-radius: 50%;
	      opacity: 0; transition: opacity 0.3s ease, background 0.3s ease;
	    }
	    .onepager-prev { left: 10px; }
	    .onepager-next { right: 10px; }
	    /* Show arrows only if user hovers over left or right zone */
	    .onepager-click-left:hover ~ .onepager-prev,
	    .onepager-click-right:hover ~ .onepager-next {
	      opacity: 1; background: rgba(0,0,0,0.5);
	    }
	    .onepager-arrow:hover {
	      background: rgba(0,0,0,0.8);
	    }

	    /* 2Ô∏è‚É£  drop this anywhere in a <style> block (after the existing .tech-right rule) */
	    .svg-stack{
	      display:flex;               /* turn the column itself into a flex-box            */
	      flex-direction:column;      /* stack children vertically                         */
	      gap:1.5rem;                 /* space between the two illustrations               */
	      align-items:center;         /* centre them horizontally                          */
	      overflow-x:auto;            /* safety-net: allow horizontal scroll if ever needed*/
	    }
	    .svg-stack .tech-svg {
	      width: 100%;
	      max-width: 600px;
	      height: auto;
	      min-height: 220px; /* ‚úÖ Give each SVG a visible presence */
	      display: block;
	    }


	    #ethos.flash {
	      background: #fff8b0;
	      transition: background 2s ease;
	    }
	    .tech-bullets ul {
	      columns: 2; /* easy responsive layout */
	      -webkit-columns: 2;
	      -moz-columns: 2;
	      list-style-type: disc;
	      padding-left: 1.5rem;
	      font-size: 1rem;
	      line-height: 1.6;
	      margin-top: 0.5rem;
	    }
	    .inline-bullets {
	      display: flex;
	      flex-wrap: wrap;
	      justify-content: center;         /* ‚úÖ Center the list */
	      gap: 0.75rem 1.5rem;             /* ‚úÖ Row gap, column gap */
	      padding: 0;
	      margin: 0.5rem auto 1rem;  /* ‚¨ÖÔ∏è top margin reduced from 1rem to 0.5rem */
	      list-style: none;                /* Remove default bullets */
	      max-width: 700px;                /* Optional: cap total width */
	    }

	    .inline-bullets li::before {
	      content: "‚Ä¢";
	      color: #5A9BD4;
	      margin-right: 0.4rem;
	      font-weight: bold;
	    }

	    .inline-bullets li {
	      font-size: 0.95rem;
	      line-height: 1.6;
	    }
	    /* ============================================================
	       Tech animated
	    ============================================================ */
		  .tech-container {
		    display: flex;
		    gap: 1rem;
		    align-items: stretch;
		    justify-content: center;
		    flex-wrap: wrap;
		    text-align: left;
		    margin-top: 1rem;
		  }
		  .tech-left {
		    flex: 0.1;      /* smaller width for text column */
		    min-width: 280px;
		  }
		  .tech-right {
		    flex: 1.2;      /* larger width for SVG */
		    min-width: 280px;
		  }
		  .tech-svg {
		    width: 100%;
		    max-width: 600px; /* increased size for better legibility */
		    height: auto;
		    display: block;
		    margin: auto;
		  }

		/* give space so content doesn't sit under sidebar on wide screens */
		@media (min-width: 920px) {
		  .main-container { padding-left: 220px; }
		}
		body.sidebar-collapsed {
		  --sidebar-w: 48px;
		}
		body.sidebar-collapsed .main-container {
		  padding-left: calc(2rem + 48px);
		}

		/* ============================================================
		   Snap Sections (one full section visible at a time)
		============================================================ */

		/* A scrollable stack that snap-locks to each child panel */
		.snap-stack{
		  /* viewport minus fixed header and a little breathing room */
		  height: calc(100vh - var(--header-h) - var(--cohort-banner-offset) - 24px);
		  overflow-y: auto;
		  overscroll-behavior: contain;
		  scroll-snap-type: y mandatory;
		  scroll-behavior: smooth;

		  /* spacer so one panel sits ‚Äúalone‚Äù in the viewport */
		  padding: 12vh 0;

		  /* nicer on iOS */
		  -webkit-overflow-scrolling: touch;
		}

		/* Each snap panel is a full ‚Äúscreen‚Äù */
		.snap-panel{
		  scroll-snap-align: center;
		  scroll-snap-stop: always;

		  min-height: calc(100vh - var(--header-h) - var(--cohort-banner-offset) - 24px);
		  display: flex;
		  align-items: center;
		  justify-content: center;

		  padding: 2rem 0;

		  /* ‚Äúhide‚Äù non-active panels until you scroll */
		  opacity: 0.18;
		  filter: blur(1px);
		  transform: scale(0.985);
		  pointer-events: none;

		  transition: opacity 220ms ease, filter 220ms ease, transform 220ms ease;
		}

		.snap-panel.is-active{
		  opacity: 1;
		  filter: none;
		  transform: scale(1);
		  pointer-events: auto;
		}

		/* Respect reduced motion */
		@media (prefers-reduced-motion: reduce){
		  .snap-stack{ scroll-behavior: auto; }
		  .snap-panel{ transition: none; }
		}	
		.stat-btn{
		  appearance: none;
		  -webkit-appearance: none;
		  border: 1px solid #e6ecf3;
		  background: linear-gradient(180deg, #ffffff 0%, #fbfcfe 100%);
		  border-radius: 14px;
		  padding: .85rem .9rem;
		  box-shadow: 0 2px 10px rgba(0,0,0,.05);
		  text-align: left;
		  width: 100%;
		  cursor: pointer;
		}

		.stat-btn:hover{
		  transform: translateY(-1px);
		  box-shadow: 0 10px 24px rgba(0,0,0,0.08);
		  border-color: rgba(90,155,212,0.45);
		}

		.stat-btn:focus-visible{
		  outline: none;
		  box-shadow: 0 0 0 3px rgba(90,155,212,0.25);
		}	
		/* ============================================================
		   Fintech/Trades: Collapsible "Tech" subsection
		============================================================ */
		.fintech-tech {
		  margin-top: 1.75rem;
		  border-top: 1px solid #eef2f7;
		  padding-top: 1.25rem;
		  text-align: left;
		}

		.fintech-tech > summary {
		  list-style: none; /* remove default marker */
		  cursor: pointer;
		  display: flex;
		  align-items: center;
		  justify-content: center; /* keeps your centered vibe */
		  gap: 0.6rem;
		  user-select: none;
		  font-weight: 800;
		  color: #2c3e50;
		  font-size: 1.6rem; /* close to h2 */
		  margin: 0.25rem 0 0.75rem;
		}

		/* hide the default triangle in Chrome/Safari */
		.fintech-tech > summary::-webkit-details-marker {
		  display: none;
		}

		.fintech-tech > summary::after {
		  content: "‚ñæ";
		  font-size: 1.1rem;
		  transform: translateY(1px);
		  transition: transform 160ms ease;
		  opacity: 0.85;
		}

		.fintech-tech[open] > summary::after {
		  transform: rotate(180deg) translateY(-1px);
		}

		/* a subtle hover state */
		.fintech-tech > summary:hover {
		  color: #34495e;
		}	
	    /* ============================================================
	      Trades KPI Grid
	    ============================================================ */

		/* Let the user scroll/drag on the strip; only the actual button is clickable */
		.trades-archive-viewport { position: relative; }
		.archive-nav {
		  pointer-events: auto; /* button itself is clickable */
		}

		.trades-archive-viewport{
		  position: relative;
		  display: flex;                 /* <-- add */
		  align-items: center;           /* <-- add */
		  gap: .35rem;                   /* space so buttons don't cover content */
		  overflow-x: auto;
		  overflow-y: hidden;
		  scroll-behavior: smooth;
		  -webkit-overflow-scrolling: touch;
		  scrollbar-width: none;
		}
		.trades-archive-viewport::-webkit-scrollbar {
		  display: none;                    /* Chrome/Safari */
		}

		.trades-archive-track {
		  display: flex;
		  gap: .65rem;
		  padding: .1rem;                   /* tiny padding so focus rings aren't clipped */
		}

		.trades-thumb {
		  flex: 0 0 calc((100% - 2 * .65rem) / 3);  /* 3 visible */
		}

		/* nav buttons stay pinned to the viewport edges while content scrolls */
		.archive-nav{
		  position: sticky;              /* <-- key change */
		  top: 50%;
		  transform: translateY(-50%);
		  background: rgba(0,0,0,0.35);
		  color: #fff;
		  border: none;
		  width: 36px;
		  height: 36px;
		  border-radius: 9999px;
		  font-size: 1.6rem;
		  cursor: pointer;
		  opacity: 0;
		  transition: opacity .2s ease, background .2s ease;
		  z-index: 5;                    /* above thumbnails */
		  flex: 0 0 auto;                /* don‚Äôt shrink */
		  pointer-events: auto;
		}

		.archive-prev{ left: 6px; }
		.archive-next{ right: 6px; }

		.trades-archive-viewport:hover .archive-nav{ opacity: 1; }
		.archive-nav:hover{ background: rgba(0,0,0,0.55); }

		.trades-archive-viewport:hover .archive-nav {
		  opacity: 1;
		}

		.archive-prev { left: 6px; }
		.archive-next { right: 6px; }

		.trades-archive-dropdown {
		  margin-top: .75rem;
		}
	    .trades-kpi-strip {
	      margin-top: 1.2rem;
	      padding-bottom: 0.25rem;
	      overflow-x: auto;
	      overflow-y: hidden;
	    }

	    .trades-kpi-grid {
	      display: grid;
	      grid-auto-flow: column;
	      grid-auto-columns: minmax(130px, 1fr);
	      grid-template-rows: repeat(2, auto); /* 2 rows visible = 8x2 feel */
	      gap: 0.75rem;
	      padding-bottom: 0.5rem;
	    }

	    .trades-kpi-card {
	      background: linear-gradient(180deg, #ffffff 0%, #fbfcfe 100%);
	      border: 1px solid #e6ecf3;
	      border-radius: 14px;
	      padding: 0.75rem 0.8rem;
	      cursor: pointer;
	      user-select: none;
	      transition:
	        transform 0.12s ease,
	        box-shadow 0.12s ease,
	        border-color 0.12s ease;
	      min-height: 96px;
	    }

	    .trades-kpi-card:hover {
	      transform: translateY(-1px);
	      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
	      border-color: rgba(90,155,212,0.45);
	    }

	    .trades-kpi-card:focus-visible {
	      outline: none;
	      box-shadow: 0 0 0 3px rgba(90,155,212,0.25);
	    }

	    .trades-kpi-icon {
	      width: 28px;
	      height: 28px;
	      border-radius: 10px;
	      background: rgba(90,155,212,0.12);
	      border: 1px solid rgba(90,155,212,0.25);
	      display: flex;
	      align-items: center;
	      justify-content: center;
	      margin-bottom: 0.45rem;
	    }

	    .trades-kpi-icon img {
	      width: 16px;
	      height: 16px;
	    }

	    .trades-kpi-name {
	      font-size: 0.78rem;
	      font-weight: 700;
	      color: #667;
	      line-height: 1.2;
	    }

	    .trades-kpi-value {
	      font-size: 1.05rem;
	      font-weight: 800;
	      color: #2c3e50;
	      margin-top: 0.15rem;
	    }

	    /* Mobile: fewer visible columns */
	    @media (max-width: 640px) {
	      .trades-kpi-grid {
	        grid-auto-columns: minmax(150px, 1fr);
	        grid-template-rows: repeat(1, auto);
	      }
	    }	
	    /* ============================================================
	      Trades Pro UI
	    ============================================================ */
	    #trades-lightbox{
	      position: fixed;
	      inset: 0;
	      display: none;
	      align-items: center;
	      justify-content: center;
	      background: rgba(0,0,0,.85);
	      z-index: 3000;
	      padding: 2rem;
	    }
	    #trades-lightbox img{
	      max-width: 92%;
	      max-height: 92%;
	      border-radius: 14px;
	    }

	    /* make header actually center in the widget */
	    .trades-wrap{
	      max-width: 960px;
	      margin: 0 auto;
	    }

	    .trades-header{
	      align-items: center;            /* instead of flex-start */
	    }

	    .trades-title{
	      text-align: left;               /* keep text readable */
	    }

	    .trades-cta{
	      margin-left: auto;
	    }

	    /* --- archive strip --- */
	    .trades-archive{
	      margin-top: 1.1rem;
	    }

	    .trades-archive-grid{
	      display: grid;
	      grid-template-columns: repeat(3, minmax(0, 1fr)); /* 3 across */
	      gap: .65rem;
	      margin-top: .65rem;
	    }

	    @media (max-width: 720px){
	      .trades-archive-grid{ grid-template-columns: 1fr; } /* stack on mobile */
	    }

	    .trades-thumb{
	      border: 1px solid #e6ecf3;
	      background: #fff;
	      border-radius: 12px;
	      padding: .5rem;
	      cursor: pointer;
	      user-select: none;
	      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
	      outline: none;
	    }

	    .trades-thumb:hover{
	      transform: translateY(-1px);
	      box-shadow: 0 10px 24px rgba(0,0,0,0.08);
	      border-color: rgba(90,155,212,0.45);
	    }

	    .trades-thumb:focus-visible{
	      box-shadow: 0 0 0 3px rgba(90,155,212,0.25);
	    }

	    .trades-thumb.active{
	      border-color: #5A9BD4;
	      box-shadow: 0 0 0 3px rgba(90,155,212,0.15);
	    }

	    .trades-thumb-date{
	      font-size: .78rem;
	      font-weight: 800;
	      color: #2c3e50;
	      margin-bottom: .35rem;
	    }

	    .trades-thumb img{
	      width: 100%;
	      height: 92px;              /* small thumbnail height */
	      object-fit: cover;
	      border-radius: 10px;
	      display: block;
	      pointer-events: none;      /* ensures parent gets click */
	    }
	    .trades-pro h2 { margin-top: 0.25rem; }

	    .trades-header{
	      display:flex;
	      justify-content: space-between;
	      align-items: center;  /* was flex-start */
	      gap: 1rem;
	      flex-wrap: wrap;
	    }

	    .trades-title{
	      flex: 1;
	      min-width: 280px;
	    }

	    .trades-cta{
	      margin-left: auto;          /* ensures it hugs right cleanly */
	      justify-content: flex-end;
	    }
	    .trades-subtitle{ color:#555; margin-top:.25rem; line-height:1.55; }

	    .trades-badge{
	      display:inline-flex;
	      align-items:center;
	      gap:.5rem;
	      font-size:.85rem;
	      color:#34495e;
	      background: rgba(90,155,212,0.10);
	      border: 1px solid rgba(90,155,212,0.25);
	      padding: .25rem .6rem;
	      border-radius: 9999px;
	    }
	    .trades-badge .dot{
	      width:8px; height:8px; border-radius:50%;
	      background:#2ecc71;
	      box-shadow: 0 0 0 3px rgba(46,204,113,0.15);
	    }

	    .btn{
	      display:inline-flex;
	      align-items:center;
	      gap:.5rem;
	      padding:.55rem .85rem;
	      border-radius: 10px;
	      font-weight: 700;
	      text-decoration: none;
	      border: 1px solid #e6ecf3;
	      background:#fff;
	      cursor:pointer;
	      transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
	    }
	    .btn:hover{
	      transform: translateY(-1px);
	      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
	    }
	    .btn-ic img{ width: 16px; height: 16px; display:block; }

	    .btn-primary{
	      background:#5A9BD4;
	      color:#fff;
	      border-color:#5A9BD4;
	    }
	    .btn-primary:hover{ background:#3c7fb8; }

	    .btn-ghost{
	      color:#2c3e50;
	      background: #fff;
	    }

	    .trades-stats{
	      display:grid;
	      grid-template-columns: repeat(4, minmax(0, 1fr));
	      gap: .85rem;
	      margin: 1rem 0 1.15rem;
	    }
	    .stat{
	      border: 1px solid #e6ecf3;
	      background: linear-gradient(180deg, #ffffff 0%, #fbfcfe 100%);
	      border-radius: 14px;
	      padding: .85rem .9rem;
	      box-shadow: 0 2px 10px rgba(0,0,0,.05);
	    }
	    .stat-ic{
	      width: 34px; height: 34px;
	      border-radius: 10px;
	      display:flex; align-items:center; justify-content:center;
	      background: rgba(90,155,212,0.12);
	      border: 1px solid rgba(90,155,212,0.25);
	      margin-bottom: .55rem;
	      color:#2c3e50;
	    }
	    .stat-ic img{ width:18px; height:18px; }
	    .stat-k{ font-size:.82rem; color:#667; }
	    .stat-v{ font-size:1.05rem; margin-top:.15rem; }
	    .stat-s{ font-size:.82rem; color:#667; margin-top:.25rem; line-height:1.35; }

	    .trades-panel{
	      border: 1px solid #e6ecf3;
	      background: #fff;
	      border-radius: 14px;
	      padding: 1rem;
	      margin-bottom: 1.1rem;
	    }

	    .panel-head h3{ margin-bottom: .2rem; }
	    .pipeline{
	      display:flex;
	      align-items: center;
	      flex-wrap: wrap;
	      gap: .55rem;
	      margin-top: .75rem;
	      margin-bottom: .85rem;
	    }
	    .pipe-step{
	      display:flex;
	      align-items:center;
	      gap:.6rem;
	      border: 1px solid #eef2f7;
	      background: #fbfcfe;
	      border-radius: 12px;
	      padding: .55rem .7rem;
	    }
	    .pipe-node{
	      width: 28px; height: 28px;
	      border-radius: 10px;
	      display:flex; align-items:center; justify-content:center;
	      font-weight:800;
	      color:#2c3e50;
	      background: rgba(90,155,212,0.14);
	      border: 1px solid rgba(90,155,212,0.28);
	    }
	    .pipe-title{ font-weight:800; color:#2c3e50; line-height:1.1; }
	    .pipe-sub{ font-size:.82rem; color:#667; margin-top:.1rem; }
	    .pipe-arrow{ color:#99a; font-weight:900; }

	    .trades-accordions{
	      display:grid;
	      grid-template-columns: repeat(2, minmax(0, 1fr));
	      gap: .75rem;
	    }
	    .acc{
	      border: 1px solid #eef2f7;
	      border-radius: 12px;
	      padding: .65rem .75rem;
	      background: #fbfcfe;
	    }
	    .acc summary{
	      cursor:pointer;
	      font-weight: 800;
	      color:#2c3e50;
	    }
	    .acc ul{ margin-top: .55rem; padding-left: 1.15rem; line-height: 1.6; color:#555; }

	    /* reuse your existing .trades-summary-box; make it look more premium */
	    .trades-summary-box{
	      background: #fbfcfe;
	      border: 1px solid #e6ecf3;
	      border-left: 4px solid #5A9BD4;
	      border-radius: 12px;
	    }

	    /* Responsive */
	    @media (max-width: 920px){
	      .trades-stats{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
	    }
	    @media (max-width: 620px){
	      .trades-stats{ grid-template-columns: 1fr; }
	      .trades-accordions{ grid-template-columns: 1fr; }
	      .trades-cta{ justify-content:flex-start; }
	    }
	    /* ============================================================
	       Responsive Adjustments
	    ============================================================ */
	    @media (max-width: 600px) {
	      .hero h1 { font-size: 2.5rem; }
	      .section-menu { flex-direction: column; align-items: center; }
	    }
	  </style>
	</head>
	<body>
	  <!-- Fixed Navbar -->
	  <div id="header-mount"></div>
	  
	  <div id="sidebar-mount"></div>

	  <!-- Main Content -->
	  <div class="main-container">
	    <!-- Hero Section -->
		<section class="hero">
		  <!-- Logo stays NON-clickable -->
		  <div class="hero-logo">
		    <img src="assets/robot_haiphen.svg" alt="Haiphen Robot Logo">
		  </div>

		  <!-- Only the tagline is the trigger -->
		  <p
		    class="hero-tagline hero-tagline-trigger"
		    data-hdl-trigger
		    role="button"
		    tabindex="0"
		    aria-label="Open device launcher"
		    style="margin-bottom: 0.5rem;"
		  >
		    API Everything ¬Æ[<span style="color: red;">‚ô•</span>]
		  </p>

		  <!-- unchanged -->
		  <div id="hero-device-launcher-mount"></div>
		</section>

		<div id="section-menu-mount"></div>

	    <!-- Content Widget (Appears on Click) -->
	    <div id="content-widget" class="content-widget"></div>
	  </div>
	  
	  <!-- Bottom Left Contact Widget -->
	  <div class="contact-widget" onclick="showSection('Contact')">
	    <img src="assets/profile.png" alt="Profile">
	    <div class="contact-popup">
	      <p><strong>Contact</strong></p>
	      <p>Founder: <a href="https://linkedin.com/in/judesafo" target="_blank" rel="noopener noreferrer">Jude Safo</a></p>
	      <p>Email: <a href="mailto:pi@haiphenai.com">pi@haiphenai.com</a></p>
	      <p>Phone: (512) 910-4544</p>
	    </div>
	  </div>
		<div id="trades-lightbox" onclick="closeTradesLightbox()" style="display:none;">
		  <img src="" alt="trades preview">
		</div>  
		<div id="lightbox" onclick="closeLightbox()" style="display:none;">
		  <img src="" alt="preview">
		</div>
		<!-- Footer sentinel: becomes visible only when user scrolls to the very bottom -->
		<div id="footer-sentinel" aria-hidden="true" style="height: 1px;"></div>

		<!-- Footer mount: injected footer lives here -->
		<div id="footer-mount"></div>  
		<div id="trades-overlay-mount"></div>	
	  <!-- JavaScript for Interactivity -->
	  <script>
	    /* ------------------------------------------------------------
	       0) Trades Section Helpers
	    ------------------------------------------------------------ */
		function openTradesLightbox(src){
		  const lb = document.getElementById('trades-lightbox');
		  const img = lb?.querySelector('img');
		  if (!lb || !img) return;
		  img.src = src;
		  lb.style.display = 'flex';
		}
		function closeTradesLightbox(){
		  const lb = document.getElementById('trades-lightbox');
		  if (lb) lb.style.display = 'none';
		}    
		async function fetchJson(url) {
		  if (typeof url !== 'string' || url.length === 0) {
		    throw new TypeError(`fetchJson(url): expected non-empty string, got ${typeof url}`);
		  }

		  // Guard *before* network call
		  if (url.includes('/v1/keys/current')) {
		    throw new Error('Deprecated endpoint: /v1/keys/current (client should not call this)');
		  }

		  const resp = await fetch(url, { cache: 'no-store' });
		  if (!resp.ok) throw new Error(`HTTP ${resp.status} for ${url}`);
		  return await resp.json();
		}

		function setActiveThumb(dateKey) {
		  document.querySelectorAll('.trades-thumb').forEach((el) => {
		    el.classList.toggle('active', el.getAttribute('data-date') === dateKey);
		  });
		}
		async function openFintechMetricByIdx(kpiIdx) {
		  try {
		    // 1) Scroll to metrics anchor (above KPI strip, above Archive)
		    const anchor = document.getElementById('fintech-metrics') || document.getElementById('trades-kpi-grid');
		    if (anchor) scrollToWithHeaderOffset(anchor, 12);

		    // 2) Ensure KPI grid exists; if not, try loading trades data (safe no-op if already loaded)
		    const grid = document.getElementById('trades-kpi-grid');
		    if (!grid) {
		      console.warn('[fintech] KPI grid missing; are we in Trades section?');
		      return;
		    }

		    // Helper to attempt opening a KPI card by idx
		    const tryOpen = () => {
		      const card = grid.querySelector(`.trades-kpi-card[data-idx="${String(kpiIdx)}"]`);
		      if (!card) return false;
		      card.click(); // uses the existing renderTradesKpiGrid() open() logic
		      return true;
		    };

		    // If cards not present yet (async render), wait a tick and retry.
		    if (tryOpen()) return;

		    // If nothing rendered yet, attempt to (re)load trades data once, then retry.
		    try {
		      await loadTradesData();
		    } catch (e) {
		      console.warn('[fintech] loadTradesData failed while opening KPI overlay', e);
		    }

		    requestAnimationFrame(() => {
		      if (!tryOpen()) {
		        console.warn('[fintech] KPI idx not found in grid', { kpiIdx });
		      }
		    });
		  } catch (err) {
		    console.warn('[fintech] openFintechMetricByIdx failed', err);
		  }
		}
		async function loadTradesByJsonUrl(jsonUrl, screenshotUrl, dateKey) {
		  const dateEl = document.getElementById('trades-date');
		  const updatedEl = document.getElementById('trades-updated');
		  const headlineEl = document.getElementById('trades-headline');
		  const summaryEl = document.getElementById('trades-summary');
		  const img = document.getElementById('trades-img');

		  try {
		    const data = await fetchJson(jsonUrl);

		    window.HAIPHEN = window.HAIPHEN || {};
		    window.HAIPHEN.CurrentTradesDay = data; // ‚úÖ after fetch

		    renderTradesKpiGrid(data.rows);

		    if (dateEl) dateEl.textContent = dateKey || data.date || '‚Äî';
		    if (updatedEl) updatedEl.textContent = data.updated_at || '‚Äî';
		    if (headlineEl) headlineEl.textContent = data.headline || '‚Äî';
		    if (summaryEl) summaryEl.textContent = data.summary || '‚Äî';

		    if (img && screenshotUrl) {
		      img.style.display = '';
		      document.getElementById('trades-img-missing').style.display = 'none';
		      img.src = screenshotUrl;
		    }

		    if (dateKey) setActiveThumb(dateKey);
		  } catch (err) {
		    console.warn('[trades] failed to load', { jsonUrl, err });
		    renderTradesKpiGrid([]);
		  }
		}

		const PAGE_SIZE = 3;
		const CAROUSEL_MAX_THUMBS = 15; // still fine, dropdown shows full history

		function renderArchive(allItems) {
		  const track = document.getElementById('trades-archive-track');
		  const viewport = track?.parentElement; // .trades-archive-viewport
		  const nextBtn = document.querySelector('.archive-next');
		  const prevBtn = document.querySelector('.archive-prev');
		  const dropdownWrap = document.getElementById('trades-archive-dropdown');
		  const select = document.getElementById('trades-archive-select');
		  
		  let userHasPannedRight = false;

		  if (!track || !viewport || !nextBtn || !prevBtn || !dropdownWrap || !select) {
		    console.warn('[trades] archive elements missing; check ids/classes in Trades template');
		    return;
		  }

		  const items = Array.isArray(allItems) ? allItems : [];
		  const carouselItems = items.slice(0, CAROUSEL_MAX_THUMBS);

		  track.innerHTML = carouselItems.map(it => `
		    <div class="trades-thumb" data-date="${escapeHtml(it.date)}" tabindex="0">
		      <div class="trades-thumb-date">${escapeHtml(it.date)}</div>
		      <img src="${escapeHtml(it.screenshot)}" alt="">
		    </div>
		  `).join('');

		  const byDate = new Map(items.map(it => [String(it.date), it]));

		  // thumb clicks (carousel subset)
		  track.querySelectorAll('.trades-thumb').forEach(el => {
		    const date = el.dataset.date;
		    const it = byDate.get(String(date));
		    if (!it) return;

		    const open = () => loadTradesByJsonUrl(it.json, deriveTradesScreenshotUrl(it), it.date);

		    el.addEventListener('click', open);
		    el.addEventListener('keydown', e => {
		      if (e.key === 'Enter' || e.key === ' ') {
		        e.preventDefault();
		        open();
		      }
		    });
		  });

		  // dropdown (FULL history)
		  select.innerHTML = items.map(it =>
		    `<option value="${escapeHtml(it.date)}">${escapeHtml(it.date)}</option>`
		  ).join('');

		  select.onchange = () => {
		    const it = byDate.get(String(select.value));
		    if (it) loadTradesByJsonUrl(it.json, deriveTradesScreenshotUrl(it), it.date);
		  };

	      function setNavVisibility() {
	        const maxScrollLeft = viewport.scrollWidth - viewport.clientWidth;
	        const atStart = viewport.scrollLeft <= 2;
	        const atEnd = viewport.scrollLeft >= (maxScrollLeft - 2);

	        // Requested behavior:
	        // - once user pans right even a little, hide both arrows
	        // - only show arrows again when they return fully left
	        if (!atStart) userHasPannedRight = true;
	        if (atStart) userHasPannedRight = false;

	        // If you haven't panned right yet, behave normally (show only what‚Äôs usable)
	        const show = !userHasPannedRight && maxScrollLeft > 2;

	        prevBtn.hidden = !(show && !atStart);
	        nextBtn.hidden = !(show && !atEnd);
	      }

	      function updateNav() {
	        dropdownWrap.hidden = items.length <= carouselItems.length;

	        // If there isn't more than one page worth, no nav needed.
	        const needsNav = carouselItems.length > PAGE_SIZE;
	        if (!needsNav) {
	          prevBtn.hidden = true;
	          nextBtn.hidden = true;
	          return;
	        }

	        setNavVisibility();
	      }

		  prevBtn.onclick = () => {
		    viewport.scrollBy({ left: -viewport.clientWidth, behavior: 'smooth' });
		  };
		  nextBtn.onclick = () => {
		    viewport.scrollBy({ left: viewport.clientWidth, behavior: 'smooth' });
		  };

		  viewport.addEventListener('scroll', updateNav, { passive: true });
		  window.addEventListener('resize', updateNav, { passive: true });

		  // reset to start (newest)
	      viewport.scrollLeft = 0;
	      userHasPannedRight = false;
	      updateNav();
		}

		async function loadTradesData() {
		  // Always load ‚Äúlatest‚Äù first
		  await loadTradesByJsonUrl(
		    'assets/trades/trades.json',
		    'assets/trades/alpaca_screenshot.png',
		    null
		  );

		  // If Trades section isn't mounted yet, bail quietly
		  const track = document.getElementById('trades-archive-track');
		  if (!track) return;

		  try {
		    const idx = await fetchJson('assets/trades/trades_index.json');
		    const items = Array.isArray(idx.items) ? idx.items : [];

		    if (items.length === 0) {
		      track.innerHTML = `<div class="trades-muted">No archive yet.</div>`;
		      return;
		    }

		    // Optional: sort newest first if dates are YYYY-MM-DD
		    items.sort((a, b) => String(b.date).localeCompare(String(a.date)));

		    // ‚úÖ THIS WAS MISSING
		    renderArchive(items);

		    // Optional: auto-load newest archive item immediately (instead of leaving ‚Äúlatest‚Äù)
		    // const first = items[0];
		    // if (first) loadTradesByJsonUrl(first.json, deriveTradesScreenshotUrl(first), first.date);

		  } catch (err) {
		    console.warn('[trades] failed to load trades_index.json', err);
		    track.innerHTML = `<div class="trades-muted">Archive unavailable.</div>`;
		  }
		}

	    const KPI_ICON_MAP = {
	      'Signals scanned': 'radar.svg',
	      'Opportunities flagged': 'flag.svg',
	      'Notifications sent': 'bell.svg',
	      'Entries opened': 'enter.svg',
	      'Exits closed': 'exit.svg',
	      'Avg hold time': 'clock.svg',
	      'Daily PnL': 'dollar.svg',
	      'Win rate': 'percent.svg',
	      'Max drawdown': 'downtrend.svg',
	      'Sharpe ratio': 'chart.svg',
	      'Delta': 'delta.svg',
	      'Gamma': 'gamma.svg',
	      'Theta': 'theta.svg',
	      'Vega': 'vega.svg',
	      'Rho': 'rho.svg',
	      'Liquidity Ratios': 'liquidity.svg',
	    };

		function renderTradesKpiGrid(rows) {
		  const grid = document.getElementById('trades-kpi-grid');
		  if (!grid) return;

		  const safeRows = Array.isArray(rows) ? rows : [];

		  grid.innerHTML = safeRows.map((r, idx) => {
		    const kpi = escapeHtml(r.kpi || '');
		    const value = escapeHtml(r.value || '‚Äî');
		    const icon = KPI_ICON_MAP[r.kpi] || 'chart.svg';

		    return `
		      <div
		        class="trades-kpi-card"
		        role="button"
		        tabindex="0"
		        data-kpi="${kpi}"
		        data-value="${value}"
		        data-idx="${idx}"
		        aria-label="${kpi}: ${value}"
		      >
		        <div class="trades-kpi-icon">
		          <img src="assets/icons/kpi/${icon}" alt="" aria-hidden="true" />
		        </div>
		        <div class="trades-kpi-name">${kpi}</div>
		        <div class="trades-kpi-value">${value}</div>
		      </div>
		    `;
		  }).join('');

		  // Wire interactions after injection
		  const cards = grid.querySelectorAll('.trades-kpi-card');
		  cards.forEach((card) => {
			const open = () => {
			  try {
			    const title = card.getAttribute('data-kpi') || 'Metric';
			    const value = card.getAttribute('data-value') || '‚Äî';

			    // prefer currently-loaded screenshot in the Trades section
			    const img = document.getElementById('trades-img');
			    const screenshotUrl =
			      img?.getAttribute('src') ||
			      img?.src ||
			      'assets/trades/alpaca_screenshot.png';

			    const day = window.HAIPHEN?.CurrentTradesDay;
			    const overlay = day?.overlay || {};

			    const series = overlay?.seriesByKpi?.[title] || null;
			    const hasSeries = Array.isArray(series) && series.length > 0;

			    const subtitle = `Current: ${value} ‚Ä¢ ${hasSeries ? 'Options day trading metrics' : 'day trading'}`;

			    const extremes = overlay?.extremes || { hi: [], lo: [] };
			    const portfolioAssets = overlay?.portfolioAssets || [];

			    const opener = window.HAIPHEN?.TradesOverlay?.open;
			    if (typeof opener === 'function') {
			      opener({
			        title,
			        subtitle,
			        screenshotUrl,
			        series,
			        extremes,
			        portfolioAssets,
			      });
			    } else {
			      console.warn('[kpi] overlay not loaded yet');
			    }
			  } catch (err) {
			    console.warn('[kpi] failed to open overlay', err);
			  }
			};

		    card.addEventListener('click', open);
		    card.addEventListener('keydown', (e) => {
		      if (e.key === 'Enter' || e.key === ' ') {
		        e.preventDefault();
		        open();
		      }
		    });
		  });
		}	
	    /* ------------------------------------------------------------
	       1) Global Variables: OnePager Carousel
	    ------------------------------------------------------------ */
	    let currentOnePagerType = 'default';
	    let currentPageIndex = 0;
	    // Your sets of PNG page images for each PDF
	    const onePagerData = {
	      default: [
	        "assets/onepager/page-01.png",
	        "assets/onepager/page-02.png",
	        "assets/onepager/page-03.png",
	        "assets/onepager/page-04.png",
	        "assets/onepager/page-05.png",
	        "assets/onepager/page-06.png",
	        "assets/onepager/page-07.png",
	        "assets/onepager/page-08.png",
	        "assets/onepager/page-09.png",
	        "assets/onepager/page-10.png",
	        "assets/onepager/page-11.png",
	        "assets/onepager/page-12.png",
	        "assets/onepager/page-13.png",
	        "assets/onepager/page-14.png",
	        "assets/onepager/page-15.png"
	      ],
	      zerodays: [
	        "assets/onepager_zerodays/page-01.png",
	        "assets/onepager_zerodays/page-02.png",
	        "assets/onepager_zerodays/page-03.png",
	        "assets/onepager_zerodays/page-04.png",
	        "assets/onepager_zerodays/page-05.png"
	        // ... add additional pages as needed
	      ]
	    };
	    /* --- inventory images for Services gallery --- */
	    const servicesImages = [
	      {file: '1.jpg', cap: 'Fig. 1'},
	      {file: '2.jpg', cap: 'Fig. 2'},
	      {file: '3.jpg', cap: 'Fig. 3'},
	      {file: '4.jpg', cap: 'Fig. 4'},
	      {file: '5.jpg', cap: 'Fig. 5'},
	      {file: '6.jpg', cap: 'Fig. 6'},
	      {file: '7.jpeg', cap: 'Fig. 7'},
	      {file: '8.png', cap: 'Fig. 8'},
	      {file: '9.png', cap: 'Fig. 9'},
	      {file: '10.png', cap: 'Fig. 10'},
	      {file: 'signals_screenshot.png', cap: 'Fig. 11: Signals'},
	      {file: 'signals_2.png', cap: 'Fig. 11: Signals 2'}
	    ];
	    /* ------------------------------------------------------------
	       2) OnePager Carousel Logic
	    ------------------------------------------------------------ */
	    function renderOnePagerPage() {
	      const imageElement = document.getElementById("onepager-image");
	      if (!imageElement) return;
	      const pages = onePagerData[currentOnePagerType];
	      imageElement.src = pages[currentPageIndex];
	    }

	    function changePage(delta) {
	      const pages = onePagerData[currentOnePagerType];
	      currentPageIndex += delta;
	      if (currentPageIndex < 0) {
	        currentPageIndex = 0;
	      } else if (currentPageIndex >= pages.length) {
	        currentPageIndex = pages.length - 1;
	      }
	      renderOnePagerPage();
	    }

	    function toggleOnePager(mode) {
	      // Switch the "type" of OnePager
	      currentOnePagerType = mode;
	      currentPageIndex = 0;
	      renderOnePagerPage();
	    }

	    function openLightbox(src){
	      const lbImg = document.querySelector('#lightbox img');
	      lbImg.src = src;
	      document.getElementById('lightbox').style.display = 'flex';
	    }
	    function closeLightbox(){
	      document.getElementById('lightbox').style.display = 'none';
	    }
	    /* ------------------------------------------------------------
	       3) Section Content (Accordion-Like) with new OnePager
	    ------------------------------------------------------------ */
	    const sectionContent = {
	        "Trades": `
	          <section id="trades-top" class="trades-wrap trades-pro hp-section-reveal">

	            <!-- Header -->
	            <header class="trades-header">
	              <div class="trades-title">
	                <div class="trades-badge">
	                  <span class="dot"></span>
	                  <span>High-freq. ‚Ä¢ automated ‚Ä¢ intraday</span>
	                </div>
	                <h2>Trades</h2>
	                <p class="trades-subtitle">
	                  High frequency, Risk profiling, Transparent daily pnl & metrics, Production-grade <strong>options execution + risk assessment</strong> trading engine. 
	                  
	                </p>
	              </div>

	              <!-- CTA Buttons -->
	              <div class="trades-cta">
					<button
					  class="btn btn-primary"
					  type="button"
					  data-gate-feature="api"
					  onclick="window.HAIPHEN?.ApiAccess?.requestApiAccess?.({ source: 'trades_request_api_access', returnTo: window.location.href })"
					>
					  Request API access
					</button>
					<a class="btn btn-ghost" href="#docs">
					  <span class="btn-ic"><img src="assets/icons/external.svg" alt=""></span>
					  Docs / Lineage
					</a>

	                <a class="btn btn-ghost" href="https://twitter.com/haiphenAI" target="_blank" rel="noopener noreferrer">
	                  <span class="btn-ic"><img src="assets/icons/external.svg" alt=""></span>
	                  Follow daily bot
	                </a>
	              </div>
	            </header>
	            <!-- Stat Cards -->
				<div class="trades-stats">
				  <button class="stat stat-btn" type="button" data-kpi-idx="0" onclick="openFintechMetricByIdx(0)">
				    <div class="stat-ic"><img src="assets/icons/cpu.svg" alt=""></div>
				    <div class="stat-k">Signals/day</div>
				    <div class="stat-v"><strong>800K ‚Äì 1.5M</strong></div>
				    <div class="stat-s">Scanned for pricing dislocations</div>
				  </button>

				  <button class="stat stat-btn" type="button" data-kpi-idx="1" onclick="openFintechMetricByIdx(1)">
				    <div class="stat-ic"><img src="assets/icons/chart.svg" alt=""></div>
				    <div class="stat-k">Contracts/day</div>
				    <div class="stat-v"><strong>2K ‚Äì 15K</strong></div>
				    <div class="stat-s">Automated entry + exit</div>
				  </button>

				  <button class="stat stat-btn" type="button" data-kpi-idx="2" onclick="openFintechMetricByIdx(2)">
				    <div class="stat-ic"><img src="assets/icons/bolt.svg" alt=""></div>
				    <div class="stat-k">Avg hold time</div>
				    <div class="stat-v"><strong>~6.7s</strong></div>
				    <div class="stat-s">Low Latency, speed & repeatability</div>
				  </button>

				  <button class="stat stat-btn" type="button" data-kpi-idx="3" onclick="openFintechMetricByIdx(3)">
				    <div class="stat-ic"><img src="assets/icons/shield.svg" alt=""></div>
				    <div class="stat-k">Overnight exposure</div>
				    <div class="stat-v"><strong>None</strong></div>
				    <div class="stat-s">Streaming portfolio risk quantization</div>
				  </button>
				</div>

	            <!-- Screenshot + meta (KEEP IDS) -->
	            <div class="trades-hero">
	              <img
	                id="trades-img"
	                class="trades-img"
	                src="assets/trades/alpaca_screenshot.png"
	                alt="Alpaca dashboard screenshot"
	                onerror="this.style.display='none'; document.getElementById('trades-img-missing').style.display='block';"
	              />
	              <div id="trades-img-missing" class="trades-muted" style="display:none;">
	                Screenshot not found yet. Run:
	                <code>node twitter-bot/src/screenshot.js</code> ‚Üí
	                <code>node twitter-bot/src/crop-screenshot.js</code> ‚Üí
	                <code>node twitter-bot/src/publish-aboutme-trades.js</code>
	              </div>

	            </div>

	            <!-- Summary (KEEP ID) -->
	            <div class="trades-summary-box">
	              <p id="trades-summary">‚Äî</p>
	            </div>
				<!-- Metrics anchor (stat cards scroll here) -->
				<div id="fintech-metrics"></div>

				<div class="trades-kpi-strip" aria-label="KPI strip">
				  <div id="trades-kpi-grid" class="trades-kpi-grid"></div>
				</div>

	            <!-- Archive (KEEP IDS) -->
				<div id="trades-archive" class="trades-archive">
				  <h3>Archive</h3>

				  <div class="trades-archive-viewport">
				    <button class="archive-nav archive-prev" aria-label="Previous" hidden>‚Äπ</button>

				    <div id="trades-archive-track" class="trades-archive-track">
				      <!-- thumbs injected here -->
				    </div>

				    <button class="archive-nav archive-next" aria-label="Next">‚Ä∫</button>
				  </div>

				  <div id="trades-archive-dropdown" class="trades-archive-dropdown" hidden>
				    <label>
				      Jump to date
				      <select id="trades-archive-select"></select>
				    </label>
				  </div>

				  <div class="trades-meta">
				    <div><strong>Date:</strong> <span id="trades-date">‚Äî</span></div>
				    <div><strong>Updated:</strong> <span id="trades-updated">‚Äî</span></div>
				    <div><strong>Headline:</strong> <span id="trades-headline">‚Äî</span></div>
				  </div>				 
				</div>
				<button
				  class="btn btn-primary"
				  type="button"
				  data-gate-feature="api"
				  onclick="window.HAIPHEN?.ApiAccess?.requestApiAccess?.({ source: 'trades_request_api_access', returnTo: window.location.href })"
				>
				  Request API access
				</button>				
				<!-- Cohort Program (moved under Fintech/Trades) -->
				<div id="cohort-mount"></div>
				<details class="fintech-tech" id="fintech-tech">
				  <summary id="portfolio-top">Tech</summary>
				  <div id="portfolio-content-top" aria-hidden="true" style="height:1px;"></div>

				  <ul style="margin-top: 0.5rem;">
				    <!-- First Portfolio Item: ETL Ingestion Engine -->
				    <li id="portfolio-etl" style="list-style: disc; margin-bottom: 2rem;">
				      <p style="margin-bottom: 0.5rem; font-size: 1.1rem; text-align: center;">
				        <strong>ETL Ingestion Engine:</strong> Prior work with a DEI tech startup
				        to build out their data infrastructure pipeline from crawling raw
				        unstructured pdf data to building a basic KG database.
				      </p>
				      <div style="text-align: center;">
				        <a href="https://github.com/JudeSafo/All_Language_Model" target="_blank" rel="noopener noreferrer">
				          <img src="assets/gitPortfolio_esg.png" alt="All Language Model"
				            style="max-width:80%; height:auto; border: 1px solid #ccc; border-radius: 4px;">
				        </a>
				      </div>
				    </li>

				    <!-- Second Portfolio Item: Protein Biomarker Indexing (Genomics Use Case) -->
				    <li id="portfolio-genomics" style="list-style: disc; margin-bottom: 2rem;">
				      <p style="margin-bottom: 0.5rem; font-size: 1.1rem; text-align: center;">
				        <strong>Protein Biomarker Indexing:</strong> Engagmenet with a Harvard Genetics research lab,
				        crawling PubMed articles to identify co-occurrences of diseases and biomarker
				        conditions for potential overlapping treatment options.
				      </p>
				      <div style="text-align: center;">
				        <a href="javascript:void(0)" onclick="showSection('OnePager')">
				          <img src="assets/genomics_usecase.png" alt="Genomics Use Case"
				            style="max-width:80%; height:auto; border: 1px solid #ccc; border-radius: 4px;">
				        </a>
				      </div>
				    </li>

				    <!-- Third Portfolio Item: Web Crawler -->
				    <li id="portfolio-crawler" style="list-style: disc; margin-bottom: 2rem;">
				      <p style="margin-bottom: 0.5rem; font-size: 1.1rem; text-align: center;">
				        <strong>Web Crawler:</strong> Custom, open src search engine for curating and parsing
				        unstructured pdf data (e.g. research, financials) for downstream applications.
				      </p>
				      <div style="text-align: center;">
				        <img src="assets/haiphen-gif5.gif" alt="Haiphen AI Showcase"
				          style="max-width:80%; height:auto; border: 1px solid #ccc; border-radius: 4px;">
				      </div>
				    </li>

				    <!-- Fourth Portfolio Item: Distilled LLM -->
				    <li style="list-style: disc; margin-bottom: 2rem;">
				      <p style="margin-bottom: 0.5rem; font-size: 1.1rem;">
				        <strong>Distilled RAG LLM:</strong> Custom open src LLM for specific business use cases,
				        e.g. answering DEI questions.
				      </p>
				      <div style="text-align: center;">
				        <img src="assets/haiphen-gif3.gif" alt="LLM"
				          style="max-width:80%; height:auto; border: 1px solid #ccc; border-radius: 4px;">
				      </div>
				    </li>

				    <!-- Fifth Portfolio Item: ZeroDays Follina Investigation -->
				    <li id="portfolio-follina" style="list-style: disc; margin-bottom: 2rem;">
				      <p style="margin-bottom: 0.5rem; font-size: 1.1rem; text-align: center;">
				        <strong>ZeroDays Follina Investigation:</strong> An in-depth investigation
				        of Confluence vulnerabilities with Follina, producing actionable security insights.
				      </p>
				      <div style="text-align: center;">
				        <a href="javascript:void(0)" onclick="showSection('OnePager')">
				          <img src="assets/haiphen-follina-screenshot.png" alt="ZeroDays Investigation"
				            style="max-width:80%; height:auto; border: 1px solid #ccc; border-radius: 4px;">
				        </a>
				      </div>
				    </li>
				  </ul>
				</details>

	          </section>
	        `,
			"Services": `
			  <section class="hp-section-reveal">
			    <div id="services-plans-mount"></div>
			  </section>
			`,
	      "OnePager": `
    <section id="mission-section" class="hp-section-reveal">
      <div id="mission-mount"></div>
    </section>
  `,
      "FAQ": `
		    <section id="faq" class="hp-section-reveal">
		      <div id="faq-mount"></div>
		    </section>
		  `,
	      "Tech": `
	        <h2>Tech Stack</h2>
	        <div class="tech-container">
	          <div class="tech-left">
	            <h3>Ethos</h3>
	            <p>
	              Open Source Everything: We spent years building our own stand alone OS environment
	              to train, test and deploy all of our models. Hence we're able to provide unmatched
	              value proposition: chain of custody insight and transparency into every asset
	              build so you minimize vulnerabilities. That includes the website your viewing now. 
	              All the code available via github. You're free to contribute as you see fit. 
	            </p>
	            <br>
	            <h3>Stack</h3>
	            <ul class="tech-list">
	              <li><i>Backend:</i> Apache Framework, Redis, Postgres</li>
	              <li><i>Network:</i> Istio, SD-WAN solutions</li>
	              <li><i>Platform:</i> Ansible, Terraform, Kubernetes</li>
	              <li><i>Access Control:</i> Keycloak, OpenFGA</li>
	              <li><i>Telemetry:</i> Prometheus, Grafana, ELK Stack</li>
	            </ul>
	            <br>
	            <h3>Secure</h3>
	            <p>
	              Industry best practices, zero-trust <strong>security protocols</strong> (e.g. SALSA, GUAC) alongside 
	                with proactive threat detection and mitigation to protect
	                your critical systems.
	            </p>
	          </div>
	          <div class="tech-right">
	            <object type="image/svg+xml" data="assets/tech_animated.svg" class="tech-svg">
	              Your browser does not support SVG.
	            </object>
	          </div>
	        </div>
	        <style>
	          .tech-container {
	            display: flex; gap: 2rem; align-items: center;
	            justify-content: center; flex-wrap: wrap; text-align: left;
	            margin-top: 2rem;
	          }
	          .tech-left {
	            flex: 1; min-width: 280px;
	          }
	          .tech-right {
	            flex: 1; min-width: 280px;
	          }
	          .tech-list {
	            list-style-type: disc; padding-left: 20px;
	            font-size: 1rem; line-height: 1.8;
	          }
	          .tech-list li i {
	            font-style: italic; font-weight: normal;
	          }
	        </style>
	      `,
		  "Contact": `
		    <section id="contact-us" class="hp-section-reveal">
		      <div id="contact-form-mount"></div>
		    </section>
		  `,
	      "Docs": `
	        <section id="docs-top">
	          <div id="api-docs-mount"></div>
	        </section>
	      `,      
	    };
	    
	    /* ------------------------------------------------------------
	       4) Show Section (Accordion-Like Display)
	    ------------------------------------------------------------ */
		function deriveTradesScreenshotUrl({ json, screenshot, date }) {
		  // If index provides a screenshot, use it.
		  if (screenshot) return screenshot;

		  // If archive json is like: assets/trades/archive/2025-12-16.json
		  // then focus screenshot should be: assets/trades/archive/2025-12-16.png
		  if (json && json.endsWith('.json')) return json.replace(/\.json$/i, '.png');

		  // Fallback (latest)
		  return 'assets/trades/alpaca_screenshot.png';
		}    
	    function scrollToWithHeaderOffset(targetEl, extra = 12) {
	      if (!targetEl) return;

	      const header =
	        document.querySelector('.site-header') ||
	        document.querySelector('#site-header .site-header') ||
	        document.querySelector('nav.navbar');

	      const headerH =
	        header?.getBoundingClientRect().height ||
	        parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h') || '70', 10) ||
	        70;

	      const bannerH =
	        parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cohort-banner-offset') || '0', 10) ||
	        0;

	      const y = window.scrollY + targetEl.getBoundingClientRect().top - headerH - bannerH - extra;
	      window.scrollTo({ top: Math.max(0, y), behavior: 'smooth' });
	    }

		/* ------------------------------------------------------------
		   Snap stacks: highlight the section currently in view
		------------------------------------------------------------ */
		function initSnapStacks(rootEl = document) {
		  const stacks = rootEl.querySelectorAll('[data-snap-stack]');
		  stacks.forEach((stack) => {
		    // Avoid double wiring
		    if (stack.__snapWired) return;
		    stack.__snapWired = true;

		    const panels = Array.from(stack.querySelectorAll('.snap-panel'));
		    if (panels.length === 0) return;

		    // Default active = first
		    panels.forEach((p, i) => p.classList.toggle('is-active', i === 0));

		    const obs = new IntersectionObserver(
		      (entries) => {
		        // pick the most visible panel as active
		        let best = null;
		        for (const e of entries) {
		          if (!best || e.intersectionRatio > best.intersectionRatio) best = e;
		        }
		        if (!best) return;

		        panels.forEach((p) => p.classList.remove('is-active'));
		        best.target.classList.add('is-active');
		      },
		      {
		        root: stack,
		        threshold: [0.35, 0.5, 0.65, 0.8],
		      }
		    );

		    panels.forEach((p) => obs.observe(p));

		    // keep a handle for cleanup if you ever need it
		    stack.__snapObserver = obs;
		  });
		}

		function wireRevealElements(root) {
		  var els = (root || document).querySelectorAll('.hp-section-reveal:not(.is-visible)');
		  if (!els.length) return;
		  var io = new IntersectionObserver(function(entries) {
		    entries.forEach(function(e) {
		      if (e.isIntersecting) { e.target.classList.add('is-visible'); io.unobserve(e.target); }
		    });
		  }, { threshold: 0.1 });
		  els.forEach(function(el) { io.observe(el); });
		}

		function showSection(sectionName) {
		  const contentWidget = document.getElementById("content-widget");
		  if (!contentWidget) return;

		  // Normalize + alias (prevents case/whitespace mismatches from menu components)
		  const raw = String(sectionName || "");
		  const key = raw.trim();

		  const ALIASES = {
		    faq: "FAQ",
		    Faq: "FAQ",
		    "Faq ": "faq",
		    collaborate: "OnePager",
		    Collaborate: "OnePager",
		    fintech: "Trades",
		    Fintech: "Trades",
		  };

		  const resolved = ALIASES[key] || ALIASES[key.toLowerCase()] || key;

		  const html = sectionContent[resolved];
		  contentWidget.innerHTML = html || `<p>No content available.</p>`;
		  contentWidget.classList.add("active");

		  // Wire fade-in reveal for section elements
		  wireRevealElements(contentWidget);

		  // Collapse sidebar when viewing API docs to give docs full width
		  document.body.classList.toggle('sidebar-collapsed', resolved === 'Docs');

		  // Dismiss all header dropdowns (prevents them staying visible after nav click)
		  document.querySelectorAll('.site-header__item').forEach(function(item) {
		    item.classList.add('is-dismissed');
		    item.addEventListener('mouseenter', function handler() {
		      item.classList.remove('is-dismissed');
		      item.removeEventListener('mouseenter', handler);
		    }, { once: true });
		  });

		  initSnapStacks(contentWidget);

		  // Section-specific bootstrapping
		  if (resolved === "Services") {
		    (async () => {
		      try { await window.HAIPHEN?.loadServicesPlans?.(); }
		      catch (e) { console.warn("[Services] loadServicesPlans failed", e); }
		      initSnapStacks(contentWidget);
		    })();
		  }

		  if (resolved === "OnePager") {
		    (async () => {
		      try { await window.HAIPHEN?.loadMission?.(); }
		      catch (e) { console.warn("[Mission] loadMission failed", e); }
		      currentPageIndex = 0;
		      renderOnePagerPage();
		      requestAnimationFrame(() => {
		        const top = document.getElementById("mission-top") || document.getElementById("mission-section") || contentWidget;
		        scrollToWithHeaderOffset(top, 12);
		      });
		    })();
		    return;
		  }

		  // Default scroll behavior for non-Trades sections
		  if (resolved === "FAQ") {
		    (async () => {
		      try {
		        // 1) Mount FAQ content (async)
		        await window.HAIPHEN?.loadFAQ?.();
		      } catch (e) {
		        console.warn("[FAQ] loadFAQ failed", e);
		      }

		      // 2) After the DOM actually exists + has size, scroll to it
		      requestAnimationFrame(() => {
		        const faqEl = document.getElementById("faq") || document.getElementById("faq-mount") || contentWidget;
		        scrollToWithHeaderOffset(faqEl, 12);
		      });
		    })();

		    // Important: don't fall through to the generic scroll below
		    return;
		  }

		  // Trades: wait for async content + DOM inflation, then scroll
		  if (resolved === "Trades") {
		    (async () => {
		      try {
		        await loadTradesData();
		      } catch (e) {
		        console.warn("[Trades] loadTradesData failed", e);
		      }
		      try {
		        const cohortMount = document.querySelector("#cohort-mount");
		        if (!cohortMount) throw new Error("Missing #cohort-mount");

		        const cohortHtmlResp = await fetch("components/cohort/cohort.html", { cache: "no-store" });
		        cohortMount.innerHTML = await cohortHtmlResp.text();
		        window.HAIPHEN?.Cohort?.init?.(cohortMount);
		      } catch (e) {
		        console.warn("[Trades] failed to load Cohort", e);
		      }

		      requestAnimationFrame(() => {
		        const tradesTop = document.getElementById("trades-top");
		        scrollToWithHeaderOffset(tradesTop || contentWidget, 12);

		        // wire the Tech dropdown behavior now that Trades DOM exists
		        initFintechTechDropdown(contentWidget);
		      });
		    })();

		    return;
		  }
		  if (resolved === "Docs") {
		    (async () => {
		      try {
		        await window.HAIPHEN?.loadApiDocs?.('#api-docs-mount');
		      } catch (e) {
		        console.warn("[Docs] loadApiDocs failed", e);
		      }

		      requestAnimationFrame(() => {
		        const top = document.getElementById("docs-top") || contentWidget;
		        scrollToWithHeaderOffset(top, 12);
		      });
		    })();

		    return;
		  }	  
		  if (resolved === "Contact") {
		    (async () => {
		      try {
		        // --- Contact form ---
		        const contactMount = document.querySelector("#contact-form-mount");
		        if (!contactMount) throw new Error("Missing #contact-form-mount");

		        const resp = await fetch("components/contact-form/contact-form.html", { cache: "no-store" });
		        contactMount.innerHTML = await resp.text();
		        window.HAIPHEN?.ContactForm?.init?.(contactMount);
		      } catch (e) {
		        console.warn("[Contact] failed to load Contact", e);
		      }

		      requestAnimationFrame(() => {
		        const top = document.getElementById("contact-us") || contentWidget;
		        scrollToWithHeaderOffset(top, 12);
		      });
		    })();

		    return;
		  }
		  if (resolved === "GettingStarted") {
		    (async () => {
		      try {
		        if (typeof window.HAIPHEN?.loadGettingStarted === 'function') {
		          await window.HAIPHEN.loadGettingStarted();
		        }
		      } catch (e) {
		        console.warn("[GettingStarted] failed to load", e);
		      }
		      requestAnimationFrame(() => {
		        scrollToWithHeaderOffset(contentWidget, 12);
		      });
		    })();
		    return;
		  }
		  if (resolved === "Profile" || resolved === "Onboarding") {
		    (async () => {
		      try {
		        if (typeof window.HAIPHEN?.showProfile === 'function') {
		          await window.HAIPHEN.showProfile({ preserveHash: true });
		        }
		      } catch (e) {
		        console.warn("[Profile] showProfile failed", e);
		      }
		    })();
		    return;
		  }

		  // Non-Trades: default scroll to widget top
		  requestAnimationFrame(() => {
		    scrollToWithHeaderOffset(contentWidget, 12);
		  });
		}

		// ------------------------------------------------------------
		// Hash routing (shareable URLs for injected sections)
		// ------------------------------------------------------------
		const SECTION_HASH = {
		  Trades: 'fintech',
		  Services: 'services',
		  Subscribe: 'subscribe',
		  OnePager: 'collaborate',
		  FAQ: 'faq',
		  Contact: 'contact-us',
		  Docs: 'docs',
		  Cohort: 'cohort',
		  Profile: 'profile',
		  Onboarding: 'onboarding',
		  GettingStarted: 'getting-started',
		};

		const HASH_SECTION = Object.fromEntries(
		  Object.entries(SECTION_HASH).map(([k, v]) => [v, k])
		);

		// ‚úÖ Cohort lives under Trades, so route #cohort -> showSection('Trades')
		HASH_SECTION['cohort'] = 'Trades';
		function clearHash({ replace = false } = {}) {
		  const url = window.location.pathname + window.location.search;
		  if (replace) history.replaceState(null, '', url);
		  else history.pushState(null, '', url);
		}

		function activateSectionMenuFor(sectionName) {
		  // Let section-menu own the styling if it‚Äôs loaded
		  const api = window.HAIPHEN?.SectionMenu;
		  if (api?.setActive) api.setActive(sectionName);
		}

		function parseHash() {
		  // supports: #faq, #faq:faq-some-id, #profile/settings
		  const raw = String(window.location.hash || "").replace(/^#/, "").trim();
		  if (!raw) return { slug: "", subId: "" };

		  // Profile uses slash separator: #profile/settings
		  if (/^profile\//i.test(raw)) {
		    const parts = raw.split("/");
		    return {
		      slug: "profile",
		      subId: (parts[1] || "").split("?")[0].trim(),
		    };
		  }

		  // Everything else uses colon separator: #faq:some-id
		  const [slugPart, subPart] = raw.split(":");
		  const cleanSlug = String(slugPart || "").split("?")[0];
		  return {
		    slug: cleanSlug.toLowerCase(),
		    subId: (subPart || "").trim(),
		  };
		}

		function setHashForSection(sectionName, subId = "", { replace = false } = {}) {
		  const slug = SECTION_HASH[sectionName];
		  if (!slug) return;

		  // Profile uses slash separator; everything else uses colon
		  const sep = slug === 'profile' ? '/' : ':';
		  const next = subId ? `#${slug}${sep}${subId}` : `#${slug}`;
		  if (window.location.hash === next) return;

		  if (replace) {
		    // Replace without adding a history entry, but still update the hash.
		    history.replaceState(null, "", next);

		    // replaceState does NOT trigger hashchange; call router manually.
		    routeFromHash();
		  } else {
		    // This WILL trigger `hashchange` and therefore `routeFromHash()`.
		    window.location.hash = next;
		  }
		}

		function openCohortModalWhenReady({ maxAttempts = 40, delayMs = 50 } = {}) {
		  const LOG = '[router#cohort]';

		  let attempts = 0;

		  const tick = () => {
		    attempts++;

		    const mount = document.querySelector('#cohort-mount');
		    const cohortApi = window.HAIPHEN?.Cohort;

		    // We consider it "ready" when:
		    // - mount exists
		    // - cohort API exists
		    // - overlay DOM exists under the mount (meaning cohort.html is injected)
		    const overlay = mount?.querySelector?.('[data-cohort-overlay]');
		    const ready = !!(mount && overlay && typeof cohortApi?.open === 'function');

		    if (ready) {
		      try {
		        // Prefer API call over "clicking" a button (less fragile)
		        cohortApi.open(mount);
		        return;
		      } catch (e) {
		        console.warn(LOG, 'open() failed', e);
		        // fall through to retry
		      }
		    }

		    if (attempts >= maxAttempts) {
		      console.warn(LOG, 'gave up waiting for cohort to mount', {
		        attempts,
		        hasMount: !!mount,
		        hasOverlay: !!overlay,
		        hasApi: typeof cohortApi?.open === 'function',
		      });
		      return;
		    }

		    setTimeout(tick, delayMs);
		  };

		  tick();
		}

		function findScrollableAncestor(el) {
		  let cur = el?.parentElement || null;
		  while (cur && cur !== document.body) {
		    const cs = getComputedStyle(cur);
		    const oy = cs.overflowY;
		    const canScroll = (oy === 'auto' || oy === 'scroll') && cur.scrollHeight > cur.clientHeight + 2;
		    if (canScroll) return cur;
		    cur = cur.parentElement;
		  }
		  return null;
		}

		function scrollToIdSmart(elementId, extra = 12) {
		  const el = document.getElementById(elementId);
		  if (!el) return false;

		  const scroller = findScrollableAncestor(el);

		  // Case A: element lives inside an internal scroll container (e.g. .snap-stack)
		  if (scroller) {
		    // Scroll the container so the element is visible
		    const top = el.offsetTop - extra;
		    scroller.scrollTo({ top: Math.max(0, top), behavior: 'smooth' });

		    // Optional: also ensure the widget itself is visible (if needed)
		    // (This won't fight the snap-stack; it just brings the widget into view.)
		    const widget = document.getElementById('content-widget');
		    if (widget) widget.scrollIntoView({ behavior: 'smooth', block: 'start' });

		    return true;
		  }

		  // Case B: normal document flow
		  scrollToWithHeaderOffset(el, extra);
		  return true;
		}

		// expose for site-search.js
		window.scrollToIdSmart = scrollToIdSmart;

		function scrollToIdWhenReady(id, { maxAttempts = 60, delayMs = 50, extra = 12 } = {}) {
		  const LOG = '[router:scrollToIdWhenReady]';
		  const targetId = String(id || '').trim();
		  if (!targetId) return;

		  let attempts = 0;

		  const tick = () => {
		    attempts++;

		    const el = document.getElementById(targetId);

		    if (el) {
		      try {
		        scrollToWithHeaderOffset(el, extra);
		      } catch (e) {
		        console.warn(LOG, 'scroll failed', e);
		      }
		      return;
		    }

		    if (attempts >= maxAttempts) {
		      console.warn(LOG, 'gave up waiting for element', {
		        id: targetId,
		        attempts,
		        hash: window.location.hash,
		      });
		      return;
		    }

		    setTimeout(tick, delayMs);
		  };

		  tick();
		}
		function routeFromHash() {
		  const { slug, subId } = parseHash();
		  if (!slug) {
		    window.HAIPHEN?.setServicesSubscribeFocus?.(false);
		    activateSectionMenuFor(null);
		    return;
		  }

		  if (slug !== 'subscribe') {
		    window.HAIPHEN?.setServicesSubscribeFocus?.(false);
		  }

		  if (slug === 'subscribe') {
		    if (typeof window.showSection === "function") {
		      window.showSection("Services");
		      activateSectionMenuFor("Services");
		    }
		    window.HAIPHEN?.setServicesSubscribeFocus?.(true);
		    scrollToIdWhenReady('services-subscribe-banner', { maxAttempts: 80, delayMs: 50, extra: 12 });
		    return;
		  }

		  if (slug === 'onboarding') {
		    if (typeof window.showSection === "function") {
		      window.showSection("Onboarding");
		      activateSectionMenuFor("Onboarding");
		    }
		    try {
		      window.HAIPHEN?.showProfile?.({ preserveHash: true, subId: 'profile-onboarding' });
		    } catch (e) {
		      console.warn('[router] #onboarding failed', e);
		    }
		    return;
		  }

		  if (slug === 'profile') {
		    if (typeof window.showSection === "function") {
		      window.showSection("Profile");
		      activateSectionMenuFor("Profile");
		    }
		    try {
		      window.HAIPHEN?.showProfile?.({ preserveHash: true, subId: subId || '', tab: subId || '' });
		    } catch (e) {
		      console.warn('[router] #profile failed', e);
		    }
		    return;
		  }

		  const section = HASH_SECTION[slug];
		  if (!section) return;

		  if (typeof window.showSection === "function") {
		    window.showSection(section);
		    activateSectionMenuFor(section);
		  }

		  if (slug === 'cohort' && !subId) {
		    scrollToIdWhenReady('cohort', { maxAttempts: 80, delayMs: 50, extra: 12 });
		    return;
		  }

		  if (slug === 'cohort' && (subId === 'survey' || subId === 'apply')) {
		    openCohortModalWhenReady();
		  }

		  if (!subId) return;

		  // Wait until the injected section (and any async inner mounts) actually exist.
		  scrollToIdWhenReady(subId, { maxAttempts: 80, delayMs: 50, extra: 12 });
		}

		window.addEventListener("hashchange", routeFromHash);
		document.addEventListener("DOMContentLoaded", routeFromHash);
		// Also: make resetLanding clear the hash so home is shareable as the base URL
		const _resetLanding = window.resetLanding;
		window.resetLanding = function resetLandingWithHashClear() {
		  clearHash({ replace: true });
		  if (typeof _resetLanding === 'function') _resetLanding();
		};

	    /* ------------------------------------------------------------
	       5) Reset Landing
	    ------------------------------------------------------------ */
	    function resetLanding() {
	      document.getElementById("content-widget").classList.remove("active");
	      window.scrollTo({ top: 0, behavior: "smooth" });
	    }

	    /* Optional - If you had an openTechModal() from the code snippet:
	       You can define it here if needed. Right now it's just a placeholder. */
	    function openTechModal() {
	      alert("Tech Modal placeholder. Implement as needed.");
	    }
	    function scrollToEthos() {
	      // slight delay so innerHTML has rendered
	      setTimeout(() => {
	        const el = document.getElementById("ethos");
	        if (!el) return;
	        el.scrollIntoView({ behavior: "smooth", block: "start" });
	        el.classList.add("flash");
	        // remove highlight after a couple seconds
	        setTimeout(() => el.classList.remove("flash"), 2000);
	      }, 200);
	    }

		function initFintechTechDropdown(root = document) {
		  const details = root.querySelector('#fintech-tech');
		  const summary = root.querySelector('#portfolio-top');
		  if (!details || !summary) return;

		  // Avoid double wiring
		  if (details.__wired) return;
		  details.__wired = true;

		  // 1) On open, scroll Tech into focus
		  details.addEventListener('toggle', () => {
		    if (details.open) {
		      requestAnimationFrame(() => {
		        scrollToWithHeaderOffset(summary, 12);
		        summary.focus?.({ preventScroll: true });
		      });
		    }
		  });

		  // 2) Collapse when user scrolls UP to any content above Tech title
		  let lastY = window.scrollY;

		  const onScroll = () => {
		    const y = window.scrollY;
		    const scrollingUp = y < lastY;
		    lastY = y;

		    if (!details.open || !scrollingUp) return;

		    const header =
		      document.querySelector('.site-header') ||
		      document.querySelector('#site-header .site-header') ||
		      document.querySelector('nav.navbar');

		    const headerH =
		      header?.getBoundingClientRect().height ||
		      parseInt(getComputedStyle(document.documentElement).getPropertyValue('--header-h') || '70', 10) ||
		      70;

		    const top = summary.getBoundingClientRect().top;

		    // If the Tech summary is below the header line while scrolling up,
		    // we are "above" Tech => collapse for legibility.
		    if (top > headerH + 16) {
		      details.open = false;
		    }
		  };

		  window.addEventListener('scroll', onScroll, { passive: true });
		  details.__teardown = () => window.removeEventListener('scroll', onScroll);
		}
	    /* ------------------------------------------------------------
	       Session widget: detect login state & update navbar
	    ------------------------------------------------------------ */
	    const AUTH_ORIGIN = 'https://auth.haiphen.io';  // change if needed

		async function updateSessionWidget() {
		  const slot = document.getElementById('session-slot');
		  if (!slot) return;

		  function showLogin() {
		    slot.innerHTML = `<a href="${AUTH_ORIGIN}/login" class="login-btn">Login</a>`;
		  }

		  try {
		    const resp = await fetch(`${AUTH_ORIGIN}/me`, { credentials: 'include' });
		    if (!resp.ok) {
		      showLogin();
		      return;
		    }

		    const user = await resp.json();
		    const displayName = user.name || user.sub || 'User';
		    const email = user.email || '‚Äî';
		    const avatar = user.avatar || 'assets/profile.png';

		    const apiCredHtml = window.HAIPHEN?.SessionProfileTemplate?.apiCredBlockHtml?.() || '';

		    slot.innerHTML = `
		      <div class="session-menu">
		        <button class="session-pill" type="button" aria-haspopup="true" aria-expanded="false">
		          <img class="session-avatar" src="${avatar}" alt="">
		          <span class="session-name">${escapeHtml(displayName)}</span>
		        </button>

		        <div class="session-dropdown" role="menu" aria-label="Session menu">
		          <div class="session-tabs" role="tablist" aria-label="Session tabs">
		            <button class="session-tab" type="button" role="tab" aria-selected="true" data-tab="profile">Profile</button>
		            <button class="session-tab" type="button" role="tab" aria-selected="false" data-tab="account">Account</button>
		          </div>

		          <div class="session-panel" role="tabpanel" data-panel="profile">
		            ${apiCredHtml}
		          </div>

		          <div class="session-panel" role="tabpanel" data-panel="account" hidden>
		            <div style="padding:12px">
		              <div style="font-weight:900; margin-bottom:6px;">Signed in</div>
		              <div class="api-muted" style="line-height:1.6;">
		                <div><strong>Name:</strong> ${escapeHtml(displayName)}</div>
		                <div><strong>Email:</strong> ${escapeHtml(email)}</div>
		              </div>
		              <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
		                <a class="api-btn api-btn-ghost" href="${AUTH_ORIGIN}/logout">Logout</a>
		              </div>
		            </div>
		          </div>
		        </div>
		      </div>
		    `;

		    wireSessionDropdown(slot);

			// Hydrate the API cred block (only when logged in)
			try {
			  await window.HAIPHEN?.ApiAccess?.hydrate?.(slot);
			} catch (e) {
			  console.warn('[session] ApiAccess.hydrate failed', e);
			}

		  } catch (err) {
		    console.warn('[session] failed to fetch /me', err);
		    showLogin();
		  }
		}

		function wireSessionDropdown(root) {
		  const menu = root.querySelector('.session-menu');
		  const trigger = root.querySelector('.session-pill');
		  const dropdown = root.querySelector('.session-dropdown');
		  if (!menu || !trigger || !dropdown) return;

		  // aria-expanded: reflect hover/focus state
		  const setExpanded = (v) => trigger.setAttribute('aria-expanded', v ? 'true' : 'false');
		  menu.addEventListener('mouseenter', () => setExpanded(true));
		  menu.addEventListener('mouseleave', () => setExpanded(false));
		  trigger.addEventListener('focus', () => setExpanded(true));
		  menu.addEventListener('focusout', () => setExpanded(false));
		  menu.addEventListener('mouseenter', async () => {
		    setExpanded(true);
		    try {
		      const apiRoot = root.querySelector('[data-api-cred]')?.closest('[data-profile-root], #session-slot') || root;
		      await window.HAIPHEN?.ApiAccess?.hydrate?.(apiRoot);
		    } catch (e) {
		      console.warn('[session] hydrate on open failed', e);
		    }
		  });

		  // Tabs
		  const tabs = Array.from(root.querySelectorAll('.session-tab'));
		  const panels = Array.from(root.querySelectorAll('.session-panel'));

		  function activate(tabName) {
		    tabs.forEach((t) => t.setAttribute('aria-selected', t.dataset.tab === tabName ? 'true' : 'false'));
		    panels.forEach((p) => {
		      const is = p.dataset.panel === tabName;
		      p.hidden = !is;
		    });
		  }

		  tabs.forEach((t) => {
		    t.addEventListener('click', () => activate(t.dataset.tab));
		  });

		  // ESC closes (same vibe as your header esc)
		  window.addEventListener('keydown', (e) => {
		    if (e.key === 'Escape') setExpanded(false);
		  });
		}

		// tiny helper: re-use your existing escapeHtml if you have it; otherwise add:
		function escapeHtml(s) {
		  return String(s ?? '')
		    .replaceAll('&', '&amp;')
		    .replaceAll('<', '&lt;')
		    .replaceAll('>', '&gt;')
		    .replaceAll('"', '&quot;')
		    .replaceAll("'", '&#039;');
		}

	    // run on load & periodically refresh
	    document.addEventListener('DOMContentLoaded', updateSessionWidget);
	    setInterval(updateSessionWidget, 5 * 60 * 1000); // refresh every 5m (optional)

		document.addEventListener('DOMContentLoaded', () => {
		  const H = window.HAIPHEN || {};
		  const safe = (fn, name) => {
		    if (typeof fn !== 'function') return;
		    try { Promise.resolve(fn()).catch((err) => console.warn(`[${name}] load failed`, err)); }
		    catch (err) { console.warn(`[${name}] load threw`, err); }
		  };

		  safe(H.loadHeader, 'header');
		  safe(H.loadSidebar, 'sidebar');
		  safe(H.loadSectionMenu, 'section-menu');
		  safe(H.loadFooter, 'footer');
		  safe(H.loadTradesOverlay, 'trades-overlay');
		  safe(H.loadSiteSearch, 'site-search');

		  // NEW
		  safe(H.loadHeroDeviceLauncher, 'hero-device-launcher');

		  // Checkout success interstitial (query param detection)
		  if (H.CheckoutSuccess?.detect?.()) {
		    H.CheckoutSuccess.show('#checkout-success-mount').catch(e =>
		      console.warn('[checkout-success] show failed', e)
		    );
		  }

		  // Chatbot navigation assistant
		  if (H.Chatbot?.init) {
		    H.Chatbot.init('#chatbot-mount').catch(e =>
		      console.warn('[chatbot] init failed', e)
		    );
		  }

		  // Cookie consent banner
		  if (H.CookieConsent?.init) {
		    H.CookieConsent.init('#cookie-consent-mount').catch(e =>
		      console.warn('[cookie-consent] init failed', e)
		    );
		  }

		  updateSessionWidget();
		});
	  </script>
	<div id="checkout-success-mount" style="display:none;"></div>
	<div id="chatbot-mount"></div>
	<div id="cookie-consent-mount"></div>
	</body>
	</html>
